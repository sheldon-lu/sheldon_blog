<!--崩溃欺骗-->
<script type="text/javascript" src="/js/src/crash_cheat.js"></script>
<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
















  <meta name="baidu-site-verification" content="pM3LIEUO3X">









<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/faviconz.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="静下心来写点东西">
<meta name="keywords" content="sheldon">
<meta property="og:type" content="website">
<meta property="og:title" content="Sheldon_Lu">
<meta property="og:url" content="https://www.sheldonlu.com/index.html">
<meta property="og:site_name" content="Sheldon_Lu">
<meta property="og:description" content="静下心来写点东西">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sheldon_Lu">
<meta name="twitter:description" content="静下心来写点东西">





  
  
  <link rel="canonical" href="https://www.sheldonlu.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Sheldon_Lu</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sheldon_Lu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/安静写点东西/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/安静写点东西/" class="post-title-link" itemprop="url">安静写点东西</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <i class="fa fa-thumb-tack"></i>
              <font color="green">置顶</font>
              <span class="post-meta-divider">|</span>
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-06 20:09:17" itemprop="dateCreated datePublished" datetime="2019-04-06T20:09:17+08:00">2019-04-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-11 08:46:37" itemprop="dateModified" datetime="2020-06-11T08:46:37+08:00">2020-06-11</time>
              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/安静写点东西/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/安静写点东西/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/安静写点东西/" class="leancloud_visitors" data-flag-title="安静写点东西">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">3.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">3 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          Welcome to my blog, Write whatever you want.
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/passages/安静写点东西/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/Golang简明教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/Golang简明教程/" class="post-title-link" itemprop="url">Golang简明教程</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-09-24 15:21:15 / Modified: 15:34:17" itemprop="dateCreated datePublished" datetime="2020-09-24T15:21:15+08:00">2020-09-24</time>
            

            
              

              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/Golang简明教程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/Golang简明教程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/Golang简明教程/" class="leancloud_visitors" data-flag-title="Golang简明教程">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">14k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">13 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Go-语言-简明教程"><a href="#Go-语言-简明教程" class="headerlink" title="Go 语言 简明教程"></a>Go 语言 简明教程</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>Go 是一个开源的编程语言，它能让构造简单、可靠且高效的软件变得容易。Go是从2007年末由Robert Griesemer, Rob Pike, Ken Thompson主持开发，后来还加入了Ian Lance Taylor, Russ Cox等人，并最终于2009年11月开源，在2012年早些时候发布了Go 1稳定版本。现在Go的开发已经是完全开放的，并且拥有一个活跃的社区。</p>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>开源</li>
<li>编译性语言, 运行高速</li>
<li>语法简洁</li>
<li>并行处理封装</li>
<li>内存管理、数组安全</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>作为编译性语言调试不如脚本方便</li>
<li>在数据分析上没有脚本适用</li>
<li>对底层的控制没有基础语言灵活</li>
</ul>
<h3 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h3><p>常应用于搭载 Web 服务器，存储集群或类似用途的巨型中央服务器的系统编程语言。对于高性能分布式系统领域而言，Go 语言无疑比大多数其它语言有着更高的开发效率。它提供了海量并行的支持，在服务端的开发优势较大。</p>
<h3 id="语言基础"><a href="#语言基础" class="headerlink" title="语言基础"></a>语言基础</h3><h4 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h4><h5 id="变量和常量"><a href="#变量和常量" class="headerlink" title="变量和常量"></a>变量和常量</h5><p>普通赋值:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var 变量名称 变量类型 = 值</span></span><br><span class="line"><span class="keyword">var</span> num <span class="keyword">int</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>平行赋值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num1,num2 <span class="keyword">int</span> = <span class="number">1</span>, <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>多行赋值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    num1 <span class="keyword">int</span> = <span class="number">1</span></span><br><span class="line">    num2 <span class="keyword">int</span> = <span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="整数类型的命名和宽度"><a href="#整数类型的命名和宽度" class="headerlink" title="整数类型的命名和宽度"></a>整数类型的命名和宽度</h5><p>Go的整数类型一共有10个其中计算架构相关的整数类型有两个:</p>
<ul>
<li>有符号的整数类型 int</li>
<li>无符号的整数类型 uint<br>在不同计算架构的计算机上，它们体现的宽度(存储某个类型的值所需要的空间)是不一样的。空间的单位可以是bit也可以是字节byte。</li>
</ul>
<p><img src="https://static.studygolang.com/190927/a6639f0384843c736113e484e6556d18.png" alt="img"></p>
<p>除了这两个计算架构相关的整数类型之外，还有8个可以显式表达自身宽度的整数类型:</p>
<p><img src="https://static.studygolang.com/190927/59e336051578f6136d1c318ed3ce19eb.png" alt="img"></p>
<h5 id="整数类型值的表示法"><a href="#整数类型值的表示法" class="headerlink" title="整数类型值的表示法"></a>整数类型值的表示法</h5><p><img src="https://static.studygolang.com/190927/c231eb2bcfb1f895b2aa51ce3e39f0e6.png" alt="img"></p>
<p>如果以8进制为变量num赋值:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">039</span> <span class="comment">// 用"0"作为前缀以表明这是8进制表示法</span></span><br></pre></td></tr></table></figure>
<p>如果以16进制为变量num赋值:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">0x39</span></span><br></pre></td></tr></table></figure>
<h5 id="浮点数类型"><a href="#浮点数类型" class="headerlink" title="浮点数类型"></a>浮点数类型</h5><p>浮点数类型有两个：float32/float64 浮点数类型的值一般由整数部分、小数点”.”和小数部分组成。另外一种表示方法是在其中加入指数部分。指数部分由”E”或”e”以及带正负号的10进制整数表示。例:3.9E-2表示浮点数0.039。3.9E+1表示浮点数39。<br>有时候浮点数类型值也可以被简化。比如39.0可以被简化为39。0.039可以被简化为.039。 在Go中浮点数的相关部分只能由10进制表示法表示。</p>
<h5 id="复数类型"><a href="#复数类型" class="headerlink" title="复数类型"></a>复数类型</h5><p>复数类型有两个:complex64和complex128。实际上，complex64类型的值会由两个float32类型的值分别表示复数的实数部分和虚数部分。而complex128类型的值会由两个float64类型的值表示复数的实数部分和虚数部分。<br>负数类型的值一般由浮点数表示的实数部分、加号”+”、浮点数表示的虚数部分以及小写字母”i”组成，比如3.9E+1 + 9.99E-2i。</p>
<h5 id="byte与rune"><a href="#byte与rune" class="headerlink" title="byte与rune"></a>byte与rune</h5><p>byte与rune都属于别名类型。byte是uint8的别名类型，而rune是int32的别名类型。<br>一个rune的类型值即可表示一个Unicode字符。一个Unicode代码点通常由”U+”和一个以十六进制表示法表示的整数表示，例如英文字母’A’的Unicode代码点为”U+0041”。<br>rune类型的值需要由单引号”‘“包裹，不过我们还可以用另外几种方式表示:</p>
<p><img src="https://static.studygolang.com/190927/07b54d588437f8df20d3e7555aadedcf.png" alt="img"></p>
<p>另外在rune类型值的表示中支持几种特殊的字符序列，即:转义符。如下图:</p>
<p><img src="https://static.studygolang.com/190927/c6daa5b5f6099f532d7fed210b4d9408.png" alt="img"></p>
<h5 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h5><p>字符串的表示法有两种，即：原生表示法和解释型表示法。原生表示法，需用用反引号”`”把字符序列包起来，如果用解释型表示法，则需要用双引号”””包裹字符序列。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str1 <span class="keyword">string</span> = “str”</span><br><span class="line"><span class="keyword">var</span> str1 <span class="keyword">string</span> = <span class="string">`str`</span></span><br></pre></td></tr></table></figure>
<p>二者的区别是，前者表示的是所见即所得的(除了回车符)。后者所表示的值中转义符会起作用。<br>字符串值是不可变的，如果我们创建了一个此类型的值，就不可能再对它本身做任何修改。</p>
<h5 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h5><p>一个数组是可以容纳若干相同类型的元素的容器。数组的长度是固定的。如下声明一个数组类型:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyNumbers [<span class="number">3</span>]<span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>类型声明语句由关键字type、类型名称和类型字面量组成<br>上面这条类型声明语句实际上是为数组类型[3]int声明了一个别名类型。这使得我们可以把MyNumbers当作数组类型[3]int来使用。<br>我们表示这样一个数组类型的值的时候。应该把该类型的类型字面量写在最左边，然后用花括号包裹该值包含的若干元素，各元素之间以(英文半角)逗号分割，即:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们把这个数组字面量赋给一个名为numbers的变量:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p>这是一条变量声明语句，它在声明变量的同时为该变量赋值</p>
<p>另一种方式是在其中的类型字面量中省略代表其长度的数组，例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [...]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p>可以用如下方式访问该变量中的任何一个元素。例:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numbers[<span class="number">0</span>]</span><br><span class="line">numbers[<span class="number">1</span>]</span><br><span class="line">numbers[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>如果要修改数组值中的某一个元素值，可以：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numbers[<span class="number">1</span>] = <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>可以用如下方式获取数组长度:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> length = <span class="built_in">len</span>(numbers)</span><br></pre></td></tr></table></figure>
<p>如果一个数组没有赋值，则它的默认值为</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[length]<span class="keyword">type</span>&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>…&#125;</span><br></pre></td></tr></table></figure>
<h5 id="切片类型"><a href="#切片类型" class="headerlink" title="切片类型"></a>切片类型</h5><p>切片(slice)与数组一样也是可以若干相同类型元素的容器。与数组不同的是切片类型的长度不确定。每个切片值都会将数组作为其底层数据结构。表示切片类型的字面量如:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]<span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>或者是:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]<span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>切片类型的声明可以这样:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MySlice []<span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>对切片值的表示也与数组值相似</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p>操作数组值的方法同样适用于切片值。还有一种操作数组的方式叫做“切片”，实施切片操作的方式就是切片表达式。例:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> number3 = [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line"><span class="keyword">var</span> slice1 = numbers3[<span class="number">1</span>:<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>上例中切片表达式numbers3[1:4]的结果为[]int{2,3,4}很明显被切下的部分不包含元素上界索引指向的元素。实际上slice1这个切片值的底层数组正是number3的值。<br>我们也可以在切片值上实施切片操作：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slice2 = slice1[<span class="number">1</span>:<span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p>除了长度切片值以及数组值还有另外一个属性–容量。数组的容量总是等于其长度，而切片值的容量往往与其长度不同。如下图:</p>
<p><img src="https://static.studygolang.com/190927/8f028c1a13e77e5f90e8757ed78afe60.png" alt="img"></p>
<p>如图所示，一个切片值的容量即为它的第一个元素值在其底层数组中的索引值与该数组长度的差值的绝对值。可以使用cap()内建函数获取数组、切片、通道类型的值的容量:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> capacity2 <span class="keyword">int</span> = <span class="built_in">cap</span>(slice2)</span><br></pre></td></tr></table></figure>
<p>切片类型属于引用类型，它的零值即为nil，即空值。如果我们只声明了一个切片类型而不为它赋值，则它的默认值 nil。</p>
<p>切片的更多操作方法有些时候我们可以在方括号中放入第三个正整数。如下图所示:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numbers3[<span class="number">1</span>:<span class="number">4</span>:<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>第三个正整数为容量上界索引，它意义在于可以把作为结果的切片值的容量设置的更小。它可以限制我们通过这个切片值对其底层数组中的更多元素的访问。上节中numbers3和slice的赋值语句如下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers3 = [<span class="number">5</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line"><span class="keyword">var</span> slice1 = numbers3[<span class="number">1</span>:<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>这时，变量slice1的值是[]int{2,3,4}。但是我们可以通过如下操作将其长度延展与其容量相同:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slice1 = slice1[:<span class="built_in">cap</span>(slice1)]</span><br></pre></td></tr></table></figure>
<p>通过此操作，变量slice1的值变为了[]int{2,3,4,5}，且其长度和容量均为4。现在number3的值中的索引值在(1,5)范围内的元素都被体现在了slice1的值中。这是以number3的值是slice1的值的底层数组为前提的。这意味着我们可以轻而易举地通过切片访问其底层数组中对应索引值更大的更多元素。如果我们编写的函数返回了这样一个切片值，那么得到它的程序很可能会通过这种技巧访问到本不应该暴露给它的元素。<br>如果我们在切片中加入了第三个索引(即容量上限索引)，如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slice1 = numbers3[<span class="number">1</span>:<span class="number">4</span>:<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>那么在此之后，我们将无法通过slice1访问到number3的值中的第五个元素。<br>虽然切片值在上述方面受到了其容量的限制。但是我们可以通过另外一种手段对其进行不受限制的扩展。这需要用到内建函数append。append会对切片值进行扩展并返回一个新的切片值，使用方法如下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slice1 = <span class="built_in">append</span>(slice1, <span class="number">6</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure>
<p>通过上述操作，slice1的值变为了[]int{2,3,4,6,7}。一旦扩展操作超出了被操作的切片值的容量，那么该切片的底层数组就会被替换 最后一种操作切片的方式是“复制”。该操作的实施方法是调用copy函数。该函数接收两个类型相同的切片值作为参数，并把第二个参数值中的元素复制到第一个参数值中的相应位置(索引值相同)上。这里有两点需要注意:</p>
<ol>
<li>这种复制遵循最小复制原则，即：被复制的元素的个数总是等于长度较短的那个参值的长度。</li>
<li>与append函数不同，copy函数会直接对其第一个参数值进行修改。</li>
</ol>
<p>例:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slice4 = []<span class="keyword">int</span>&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;</span><br><span class="line"><span class="built_in">copy</span>(slice4, slice1)</span><br></pre></td></tr></table></figure>
<p>通过上述复制操作，slice4会变成[]int{2,3,4,6,7,0,0}。</p>
<h5 id="字典类型"><a href="#字典类型" class="headerlink" title="字典类型"></a>字典类型</h5><p>Go语言的字典(Map)类型是一个哈希表的实现。字典类型的字面量如下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">map</span>[K]T</span><br></pre></td></tr></table></figure>
<p>其中，”K”为键的类型，而”T”则代表元素(值)的类型。如果我们描述一个键类型为int，值类型为string的字典类型的话：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>字典的键类型必须是可比较的，否则会引起错误，即键不能是切片、字典、函数类型</p>
<p>字典值的字面量表示法实际上与数组的切片的字面量表示法很相似。最左边仍然是类型字面量，右边紧挨着由花括号包裹且有英文逗号分隔的键值对。每个键值对的键和值之间由冒号分隔。以字典类型map[int]string为例。他的值的字面量可以是这样的：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;<span class="number">1</span>:<span class="string">"a"</span>,<span class="number">2</span>:<span class="string">"b"</span>m,<span class="number">3</span>:<span class="string">"c"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以把这个值赋给一个变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mm := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;<span class="number">1</span>:<span class="string">"a"</span>,<span class="number">2</span>:<span class="string">"b"</span>,<span class="number">3</span>:<span class="string">"c"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>可用索引表达式取出字典中的值：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b := mm[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>可以用索引表达式赋值:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mm[<span class="number">2</span>] = b + <span class="string">"2"</span></span><br></pre></td></tr></table></figure>
<p>这样mm中键为2的值变为了”b2”。可以用如下方式向字典中添加一个键值对:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mm[<span class="number">4</span>] = <span class="string">""</span></span><br></pre></td></tr></table></figure>
<p>对于字典值来说，如果指定键没有对应的值则默认为该类型的空值。所以mm[5]会返回一个””。但是这样的话我们就不知道mm[5]到底是””还是mm[5]没有这个值。所以go提供了另外一种写法:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e, ok := mm[<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<p>针对字典的索引表达式可以有两个求职结果，第二个求职结果是bool类型的。它用于表明字典值中是否存在指定的键值对。 从字典中删除键值对的方法非常简单，仅仅是调用内建函数delete：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">delete</span>(mm, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>无论mm中是否存在以4为键的键值对，delete都删除。 字典类型属于引用类型，它的零值即为nil</p>
<h5 id="通道类型"><a href="#通道类型" class="headerlink" title="通道类型"></a>通道类型</h5><p>通道(Channel)是Go语言中一种非常独特的数据结构。它可用于在不同Goroutine之间传递类型化的数据。并且是并发安全的。相比之下，之前几种数据类型都不是并发安全的。<br>Goroutine可以被看作是承载可被并发执行的代码块的载体。它们由Go语言的运行时系统调度，并依托操作系统线程(又称内核线程)来并发地执行其中的代码块。<br>通道类型的表示方法很简单，仅由两部分组成:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">chan</span> T</span><br></pre></td></tr></table></figure>
<p>在这个类型字面量中，左边是代表通道类型的关键字chan,而右边则是一个可变的部分，即代表该通道类型允许传递的数据的类型(或称通道的元素类型)。<br>与其他的数据类型不同，我们无法表示一个通道类型的值，因此，我们无法用字面量来为通道类型的变量赋值。只能通过调用内建函数make来达到目的。make参数可接受两个参数，第一个参数是代表了将被初始化的值的类型的字面量(例: chan int),而第二个参数则是值的长度，例如,若我们想要初始化一个长度为5且元素类型为int的通道值，则需要这样写:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>make函数也可以被用来初始化切片类型或字典类型的值。<br>暂存在通道值中的数据是先进先出。下面，我们声明一个通道类型的变量，并为其赋值:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>这样一来，我们就可以使用接受操作符&lt;-向通道值发送数据了。当然，也可以使用它从通道值接收数据，例如，如果我们要向通道ch1 发送字符串”value1”，那么应该这样做:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch1 &lt;- “value1<span class="string">"</span></span><br></pre></td></tr></table></figure>
<p>如果我们从ch1那里接收字符串，则要这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;- ch1</span><br></pre></td></tr></table></figure>
<p>我们可以把接受到字符串赋给一个变量，如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value := &lt;- ch1</span><br></pre></td></tr></table></figure>
<p>与针对字典值的索引表达式一样，针对通道值的接受操作也可以有第二个结果值:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value, ok := &lt;- ch1</span><br></pre></td></tr></table></figure>
<p>这里的ok的值是bool类型的。它代表了通道值的状态，true代表通道值有效，而false则代表通道值已无效(或称已关闭)，更深层次的原因是，如果在接受操作进行之前或过程中通道值被关闭了，则接收操作会立即结束并返回一个该通道值的元素类型的零值。<br>可以通过函数close来关闭通道:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">close(ch1)</span><br></pre></td></tr></table></figure>
<p>对通道值的重复关闭会引发运行时异常，会使程序崩溃。在通道值有效的前提下，针对它的发送操作会在通道值已满(其中缓存的数据的个数已等于它的长度)时被阻塞。而向一个已被关闭的通道值发送数据会引发运行时异常。针对有效通道值的接收操作会在它已经为空时被阻塞。通道类型属于引用类型，它的零值为nil。</p>
<h4 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h4><h5 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h5><p>对应的关键字为if、 else和else if；</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> a := <span class="number">1</span>; a &gt;= <span class="number">1</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"OK"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="选择语句"><a href="#选择语句" class="headerlink" title="选择语句"></a>选择语句</h5><p>对应的关键字为switch、 case和select</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> i &#123;</span><br><span class="line"> <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line"> fmt.Printf(<span class="string">"0"</span>)</span><br><span class="line"> <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"> fmt.Printf(<span class="string">"1"</span>)</span><br><span class="line"> <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line"> <span class="keyword">fallthrough</span></span><br><span class="line"> <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line"> fmt.Printf(<span class="string">"3"</span>)</span><br><span class="line"> <span class="keyword">case</span> <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>:</span><br><span class="line"> fmt.Printf(<span class="string">"4, 5, 6"</span>)</span><br><span class="line"> <span class="keyword">default</span>:</span><br><span class="line"> fmt.Printf(<span class="string">"Default"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h5><p>对应的关键字为for和range；</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line"> sum += i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="跳转语句"><a href="#跳转语句" class="headerlink" title="跳转语句"></a>跳转语句</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myfunc</span><span class="params">()</span></span> &#123;</span><br><span class="line"> i := <span class="number">0</span></span><br><span class="line"> HERE:</span><br><span class="line"> fmt.Println(i)</span><br><span class="line"> i++</span><br><span class="line"> <span class="keyword">if</span> i &lt; <span class="number">10</span> &#123;</span><br><span class="line"> <span class="keyword">goto</span> HERE</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><h5 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h5><p>首先函数的格式是固定的，func＋函数名＋ 参数 ＋ 返回值（可选） ＋ 函数体。例 :</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span>（） </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">"Hello go"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在golang中有两个特殊的函数，main函数和init函数，main函数不用介绍在所有语言中都一样，它作为一个程序的入口，只能有一个。init函数在每个package是可选的，可有可无，甚至可以有多个(但是强烈建议一个package中一个init函数)，init函数在你导入该package时程序会自动调用init函数，所以init函数不用我们手动调用,另外它只会被调用一次，因为当一个package被多次引用时，它只会被导入一次。</p>
<h5 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h5><ul>
<li>普通变量<br>使用普通变量作为函数参数的时候，在传递参数时只是对变量值得拷贝，即将实参的值复制给变参，当函数对变参进行处理时，并不会影响原来实参的值。</li>
<li>指针<br>函数的变量不仅可以使用普通变量，还可以使用指针变量，使用指针变量作为函数的参数时，在进行参数传递时将是一个地址看呗，即将实参的内存地址复制给变参，这时对变参的修改也将会影响到实参的值。</li>
<li>数组<br>和其他语言不同的是，go语言在将数组名作为函数参数的时候，参数传递即是对数组的复制。在形参中对数组元素的修改都不会影响到数组元素原来的值。</li>
<li>slice, map, chan<br>在使用slice, map, chan 作为函数参数时，进行参数传递将是一个地址拷贝，即将底层数组的内存地址复制给参数slice, map, chan 。这时，对slice, map, chan 元素的操作就是对底层数组元素的操作。</li>
<li>函数名字<br>在go语言中，函数也作为一种数据类型，所以函数也可以作为函数的参数来使用。</li>
</ul>
<h5 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h5><p>go语言可以返回局部变量的指针，因为go语言的回收机制是当销毁栈上的临时数据且发现有被外部引用的栈上变量时，会自动转移到堆上。</p>
<h5 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h5><p>和其他语言类似，golang也支持闭包函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">()</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">     sum := <span class="number">0</span></span><br><span class="line">     <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">          sum += x</span><br><span class="line">          <span class="keyword">return</span> sum</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">     pos, neg := adder(), adder()</span><br><span class="line">     <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">          fmt.Println(</span><br><span class="line">               pos(i),</span><br><span class="line">               neg(<span class="number">-2</span>*i),</span><br><span class="line">          )</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><h5 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Poem <span class="keyword">struct</span> &#123;</span><br><span class="line">    Title  <span class="keyword">string</span></span><br><span class="line">    Author <span class="keyword">string</span></span><br><span class="line">    intro  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就声明了一个类，其中没有public、protected、private的的声明。<strong>golang用另外一种做法来实现属性的访问权限：属性的开头字母是大写的则在其它包中可以被访问，否则只能在本包中访问。类的声明和方法亦是如此</strong>。</p>
<h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(poem *Poem)</span> <span class="title">publish</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"poem publish"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(poem Poem)</span> <span class="title">publish</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"poem publish"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和其它语言不一样，golang声明方法和普通方法一致，只是在func后增加了poem <em>Poem这样的声明。加</em>和没有加*的区别在于一个是传递指针对象，一个是传递值对象。</p>
<p>注意当创建了方法1后将会默认创建出方法2,反之则不会。</p>
<h5 id="类的实例化"><a href="#类的实例化" class="headerlink" title="类的实例化"></a>类的实例化</h5><p>实例化对象有好几种方式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">poem := &amp;Poem&#123;&#125;</span><br><span class="line"></span><br><span class="line">poem.Author = <span class="string">"Heine"</span></span><br><span class="line"></span><br><span class="line">poem2 := &amp;Poem&#123;Author: <span class="string">"Heine"</span>&#125;</span><br><span class="line"></span><br><span class="line">poem3 := <span class="built_in">new</span>(Poem)</span><br><span class="line"></span><br><span class="line">poem3.Author = <span class="string">"Heine"</span></span><br><span class="line"></span><br><span class="line">poem4 := Poem&#123;&#125;</span><br><span class="line"></span><br><span class="line">poem4.Author = <span class="string">"Heine"</span></span><br><span class="line"></span><br><span class="line">poem5 := Poem&#123;Author: <span class="string">"Heine"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>实例化的时候可以初始化属性值，如果没有指明则默认为系统默认值。</p>
<h5 id="伪继承"><a href="#伪继承" class="headerlink" title="伪继承"></a>伪继承</h5><p>golang中不存在继承，但可以使用组合的方式达到类似的效果.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Poem)</span> <span class="title">ShowTitle</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Printf(e.Title)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Poem <span class="keyword">struct</span> &#123;</span><br><span class="line">    Title  <span class="keyword">string</span></span><br><span class="line">    Author <span class="keyword">string</span></span><br><span class="line">    intro  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ProsePoem <span class="keyword">struct</span> &#123;</span><br><span class="line">    Poem</span><br><span class="line">    Author <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ProsePoem属性中声明了Poem，表示组合了Poem的属性和方法<strong>(属性和方法都会被继承)</strong>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">prosePoem := &amp;ProsePoem&#123;</span><br><span class="line">        Poem: Poem&#123;</span><br><span class="line">            Title:  <span class="string">"Jack"</span>,</span><br><span class="line">            Author: <span class="string">"slow"</span>,</span><br><span class="line">            intro:  <span class="string">"simple"</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        Author: <span class="string">"test"</span>,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>如果其中属性有冲突，则以外围的为主，也就是说会被覆盖。同样类方法出现冲突时也会覆盖，并不会支持重载</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ProsePoem <span class="keyword">struct</span> &#123;</span><br><span class="line">    Poem</span><br><span class="line">    Author <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>当访问Author的时候默认为ProsePoem的Author，如果需要访问Poem的Author属性可以使用</strong><br><strong>prosePoem.Poem.Author来访问方法同理</strong>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">prosePoem := &amp;ProsePoem&#123;&#125;</span><br><span class="line"></span><br><span class="line">prosePoem.Author = <span class="string">"Shelley"</span></span><br><span class="line"></span><br><span class="line">prosePoem.Poem.Author = <span class="string">"Heine"</span></span><br><span class="line"></span><br><span class="line">fmt.Println(prosePoem)</span><br></pre></td></tr></table></figure>
<p>从输出中可以很直观看到这一点。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;&#123;&#123; Heine &#125; Shelley&#125;</span><br></pre></td></tr></table></figure>
<h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><p>Golang的interface是方法的集合也是一种类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">interface</span> &#123;</span><br><span class="line">    Speak() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span> <span class="title">Speak</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"cat"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Dog)</span> <span class="title">Speak</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"dog"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test</span><span class="params">(params <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    fmt.Println(params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    animals := []Animal&#123;Cat&#123;&#125;, Dog&#123;&#125;&#125;</span><br><span class="line">    <span class="keyword">for</span> _, animal := <span class="keyword">range</span> animals &#123;</span><br><span class="line">        fmt.Println(animal.Speak())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Test(<span class="string">"string"</span>)</span><br><span class="line">    Test(<span class="number">123</span>)</span><br><span class="line">    Test(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上所示，将Struct 向 Interface变量赋值，实际作用是Interface获取了Struct中方法的实现集合。</p>
<h4 id="断言和反射"><a href="#断言和反射" class="headerlink" title="断言和反射"></a>断言和反射</h4><p>断言是预判确认变量的类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    v := <span class="string">"hello world"</span></span><br><span class="line">    fmt.Println(typeof(v))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typeof</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> t := v.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"int"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">float64</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"float64"</span></span><br><span class="line">    <span class="comment">//... etc</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        _ = t</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"unknown"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>反射则是因为interface中实际记录的有存储对象的类型，可以提取出变量的类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"reflect"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    v := <span class="string">"hello world"</span></span><br><span class="line">    fmt.Println(typeof(v))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">typeof</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> reflect.TypeOf(v).String()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-7-回收处理"><a href="#4-7-回收处理" class="headerlink" title="4.7 回收处理"></a>4.7 回收处理</h4><p>在golang当中，defer代码块会在函数调用链表中增加一个函数调用。这个函数调用不是普通的函数调用，而是会在函数正常返回，也就是return之后添加一个函数调用。因此，defer通常用来释放函数内部变量。</p>
<p>如下示例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CopyFile</span><span class="params">(dstName, srcName <span class="keyword">string</span>)</span> <span class="params">(written <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line">src, err := os.Open(srcName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> src.Close()</span><br><span class="line"></span><br><span class="line">dst, err := os.Create(dstName)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> dst.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> io.Copy(dst, src)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过defer，我们可以在代码中优雅的关闭/清理代码中所使用的变量。defer作为golang清理变量的特性，有其独有且明确的行为。以下是defer三条使用规则。</p>
<ul>
<li>当defer被声明时，其参数就会被实时解析<br>即defer的参数的变量值，在代码中defer使用后的位置改变并不会对改变defer用到的值</li>
<li>defer执行顺序为先进后出<br>在函数中，先定义的defer将会后执行</li>
<li>defer可以读取有名返回值<br>defer代码块的作用域仍然在函数之内，因此defer仍然可以读取函数内的变量</li>
</ul>
<h4 id="make和new的区别"><a href="#make和new的区别" class="headerlink" title="make和new的区别"></a>make和new的区别</h4><p>new 的作用是初始化一个指向类型的指针(*T)，make 的作用是为 slice，map 或 chan 初始化并返回引用(T)。</p>
<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><p>对于异常处理，golang提供了recover和panic。</p>
<p>如下示例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"1"</span>)</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"fault"</span>)</span><br><span class="line">    fmt.Println(<span class="string">"2"</span>)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">运行结果：</span><br><span class="line">fault</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>程序首先运行panic，出现故障，此时跳转到包含recover()的defer函数执行，recover捕获panic，此时panic就不继续传递．但是recover之后，程序并不会返回到panic那个点继续执行以后的动作，而是在recover这个点继续执行以后的动作，即执行上面的defer函数，输出１.</p>
<p>利用recover处理panic指令，必须利用defer在panic之前声明，否则当panic时，recover无法捕获到panic，无法防止panic扩散．</p>
<h4 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h4><p>Go调度的几个概念：</p>
<p>M：内核线程；<br>G：go routine，并发的最小逻辑单元，由程序员创建；<br>P：处理器，执行G的上下文环境，每个P会维护一个本地的go routine队列；</p>
<p><img src="https://static.studygolang.com/190927/f19c0608b3bda1fa5179412c45a5a307.png" alt="img"></p>
<p>除了每个P拥有一个本地的go routine队列外，还存在一个全局的go routine队列。</p>
<p>具体调度原理：</p>
<ol>
<li>P的数量在初始化由GOMAXPROCS决定；</li>
<li>我们要做的就是添加G；</li>
<li>G的数量超出了M的处理能力，且还有空余P的话，runtime就会自动创建新的M；</li>
<li>M拿到P后才能干活，取G的顺序：本地队列&gt;全局队列&gt;其他P的队列，如果所有队列都没有可用的G，M会归还P并进入休眠；</li>
</ol>
<p>一个G如果发生阻塞等事件会进行阻塞，如下图：</p>
<p><img src="https://static.studygolang.com/190927/0ac890708a97a7be7c28b6a208bac660.png" alt="img"></p>
<p>G发生上下文切换条件：</p>
<ul>
<li>系统调用；</li>
<li>读写channel；</li>
<li>gosched主动放弃，会将G扔进全局队列；</li>
</ul>
<p>如上图，一个G发生阻塞时，M0让出P，由M1接管其任务队列；当M0执行的阻塞调用返回后，再将G0扔到全局队列，自己则进入睡眠（没有P了无法干活）；</p>
<p>下面例子说明协程的使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"runtime"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">say</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        runtime.Gosched()</span><br><span class="line">        fmt.Println(s)</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> say(<span class="string">"world"</span>)</span><br><span class="line">    say(<span class="string">"hello"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输出结果：</span><br><span class="line"></span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<p>1、先输出了hello,后输出了world.</p>
<p>2、hello输出了2个，world输出了1个（因为第2个hello输出完，主线程就退出了，第2个world没机会了）</p>
<p>把代码中的runtime.Gosched()注释掉，执行结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<p>因为say(“hello”)这句占用了时间，等它执行完，线程也结束了，say(“world”)就没有机会了。</p>
<p>这里同时可以看出，go中的goroutins并不是同时在运行。事实上，如果没有在代码中通过</p>
<p>runtime.GOMAXPROCS(n) 其中n是整数，</p>
<p>指定使用多核的话，goroutins都是在一个线程里的，它们之间通过不停的让出时间片轮流运行，达到类似同时运行的效果。</p>
<h4 id="包管理"><a href="#包管理" class="headerlink" title="包管理"></a>包管理</h4><h5 id="package-的导入语法"><a href="#package-的导入语法" class="headerlink" title="package 的导入语法"></a>package 的导入语法</h5><p>写 Go 代码的时经常用到 import 这个命令用来导入包，参考如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import( &quot;fmt&quot; )</span><br></pre></td></tr></table></figure>
<p>然后在代码里面调用该包的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println( &quot;hello go&quot; )</span><br></pre></td></tr></table></figure>
<p>fmt 是 Go 的标准库，它其实是去 GOROOT 下去加载该模块，当然 Go 的 import 还支持如下两种方式来加载自己写的模块：</p>
<ul>
<li>相对路径<br>import “./model” // 当前文件同一目录的 model 目录，但是不建议这种方式 import</li>
<li>绝对路径<br>import “shorturl/model” // 加载 GOPATH/src/shorturl/model 模块</li>
</ul>
<h5 id="package-的导入的特殊用法"><a href="#package-的导入的特殊用法" class="headerlink" title="package 的导入的特殊用法"></a>package 的导入的特殊用法</h5><p>上面展示了一些 import 常用的几种方式，但是还有一些特殊的 import ，让很多新手很费解，下面是三种导入包的使用方法。</p>
<p><strong>点操作</strong></p>
<p>有时候会看到如下的方式导入包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import( </span><br><span class="line">    . &quot;fmt&quot; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>这个点操作的含义就是这个包导入之后在你调用这个包的函数时，你可以省略前缀的包名，也就是前面你调用的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println( &quot;hello go&quot; )</span><br></pre></td></tr></table></figure>
<p>可以写成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Println( &quot;hello go&quot; )</span><br></pre></td></tr></table></figure>
<p><strong> 别名操作</strong><br>别名操作顾名思义可以把包命名成另一个用起来容易记忆的名字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import( </span><br><span class="line">    f &quot;fmt&quot; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>别名操作调用包函数时前缀变成了重命名的前缀，即：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f.Println( &quot;hello go&quot; )</span><br></pre></td></tr></table></figure>
<p><strong>下划线操作</strong><br>这个操作经常是让很多人费解的一个操作符，请看下面这个 import</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import ( </span><br><span class="line">    _ “github.com/xiyanxiyan10/misakago&quot; </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>下划线操作并不想引用该包中的方法等，只是希望导入包时自动执行其中的Init()函数来做需要的初始化工作。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/Linux之route详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/Linux之route详解/" class="post-title-link" itemprop="url">Linux之route详解</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-09-24 14:31:03 / Modified: 14:37:22" itemprop="dateCreated datePublished" datetime="2020-09-24T14:31:03+08:00">2020-09-24</time>
            

            
              

              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/Linux之route详解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/Linux之route详解/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/Linux之route详解/" class="leancloud_visitors" data-flag-title="Linux之route详解">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">6.4k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">6 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Linux-路由表详解及-route-命令详解"><a href="#Linux-路由表详解及-route-命令详解" class="headerlink" title="Linux 路由表详解及 route 命令详解"></a>Linux 路由表详解及 route 命令详解</h2><h3 id="Linux-内核的路由表"><a href="#Linux-内核的路由表" class="headerlink" title="Linux 内核的路由表"></a>Linux 内核的路由表</h3><p>通过 <code>route</code> 命令查看 Linux 内核的路由表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         gateway         0.0.0.0         UG    0      0        0 eth0</span><br><span class="line">10.0.0.10       10.139.128.1    255.255.255.255 UGH   0      0        0 eth0</span><br><span class="line">10.139.128.0    0.0.0.0         255.255.224.0   U     0      0        0 eth0</span><br><span class="line">link-local      0.0.0.0         255.255.0.0     U     1002   0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line">172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-0ab63c131848</span><br><span class="line">172.19.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-bccbfb788da0</span><br><span class="line">172.20.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-7485db25f958</span><br><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.139.128.1    0.0.0.0         UG    0      0        0 eth0</span><br><span class="line">10.0.0.10       10.139.128.1    255.255.255.255 UGH   0      0        0 eth0</span><br><span class="line">10.139.128.0    0.0.0.0         255.255.224.0   U     0      0        0 eth0</span><br><span class="line">169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line">172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-0ab63c131848</span><br><span class="line">172.19.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-bccbfb788da0</span><br><span class="line">172.20.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-7485db25f95812345678910111213141516171819202122</span><br></pre></td></tr></table></figure>
<p>各列字段说明：</p>
<table>
<thead>
<tr>
<th>列</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Destination</td>
<td>目标网络或目标主机。Destination 为 default（<code>0.0.0.0</code>）时，表示这个是默认网关，所有数据都发到这个网关（这里是 <code>10.139.128.1</code>）</td>
</tr>
<tr>
<td>Gateway</td>
<td>网关地址，<code>0.0.0.0</code> 表示当前记录对应的 Destination 跟本机在同一个网段，通信时不需要经过网关</td>
</tr>
<tr>
<td>Genmask</td>
<td>Destination 字段的网络掩码，Destination 是主机时需要设置为 <code>255.255.255.255</code>，是默认路由时会设置为 <code>0.0.0.0</code></td>
</tr>
<tr>
<td>Flags</td>
<td>标记，含义参考表格后面的解释</td>
</tr>
<tr>
<td>Metric</td>
<td>路由距离，到达指定网络所需的中转数，是大型局域网和广域网设置所必需的 （不在Linux内核中使用。）</td>
</tr>
<tr>
<td>Ref</td>
<td>路由项引用次数 （不在Linux内核中使用。）</td>
</tr>
<tr>
<td>Use</td>
<td>此路由项被路由软件查找的次数</td>
</tr>
<tr>
<td>Iface</td>
<td>网卡名字，例如 <code>eth0</code></td>
</tr>
</tbody>
</table>
<p>Flags 含义：</p>
<ul>
<li>U 路由是活动的</li>
<li>H 目标是个主机</li>
<li>G 需要经过网关</li>
<li>R 恢复动态路由产生的表项</li>
<li>D 由路由的后台程序动态地安装</li>
<li>M 由路由的后台程序修改</li>
<li>! 拒绝路由</li>
</ul>
<h3 id="Linux-内核的路由种类"><a href="#Linux-内核的路由种类" class="headerlink" title="Linux 内核的路由种类"></a>Linux 内核的路由种类</h3><h4 id="主机路由"><a href="#主机路由" class="headerlink" title="主机路由"></a>主机路由</h4><p>路由表中指向单个 IP 地址或主机名的路由记录，其 Flags 字段为 H。下面示例中，对于 <code>10.0.0.10</code> 这个主机，通过网关 <code>10.139.128.1</code> 网关路由：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">10.0.0.10       10.139.128.1    255.255.255.255 UGH   0      0        0 eth0</span><br><span class="line">...12345</span><br></pre></td></tr></table></figure>
<h4 id="网络路由"><a href="#网络路由" class="headerlink" title="网络路由"></a>网络路由</h4><p>主机可以到达的网络。下面示例中，对于 <code>10.0.0.0/24</code> 这个网络，通过网关 <code>10.139.128.1</code> 网关路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">10.0.0.0        10.139.128.1    255.255.255.0   UG    0      0        0 eth01234</span><br></pre></td></tr></table></figure>
<h4 id="默认路由"><a href="#默认路由" class="headerlink" title="默认路由"></a>默认路由</h4><p>当目标主机的 IP 地址或网络不在路由表中时，数据包就被发送到默认路由（默认网关）上。默认路由的 <code>Destination</code> 是 default 或 <code>0.0.0.0</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         gateway         0.0.0.0         UG    0      0        0 eth01234</span><br></pre></td></tr></table></figure>
<h3 id="route-命令"><a href="#route-命令" class="headerlink" title="route 命令"></a>route 命令</h3><p>route 命令可以显示或设置 Linux 内核中的路由表，主要是静态路由。</p>
<p>对于局域网中的 Linux 主机，要想访问 Internet，需要将局域网的网关 IP 地址设置为这个主机的默认路由。在命令行中通过 <code>route</code> 命令添加的路由在网卡重启或机器重启后失效。可以在 <code>/etc/rc.local</code> 中添加 route 命令来保证路由设置永久有效。</p>
<p>选项:</p>
<ul>
<li><code>-A</code>：设置地址类型</li>
<li><code>-C</code>：打印 Linux 内核的路由缓存</li>
<li><code>-v</code>：显示详细信息</li>
<li><code>-n</code>：不执行 DNS 反向查找，直接显示数字形式的 IP 地址</li>
<li><code>-e</code>：netstat 格式显示路由表</li>
<li><code>-net</code>：到一个网络的路由表</li>
<li><code>-host</code>：到一个主机的路由表</li>
</ul>
<p>参数：</p>
<ul>
<li>add：增加路由记录</li>
<li>del：删除路由记录</li>
<li>target：目的网络或目的主机</li>
<li>gw：设置默认网关</li>
<li>mss：设置TCP的最大区块长度（MSS），单位MB</li>
<li>window：指定通过路由表的TCP连接的TCP窗口大小</li>
<li>dev：路由记录所表示的网络接口</li>
</ul>
<h4 id="添加路由-add"><a href="#添加路由-add" class="headerlink" title="添加路由 add"></a>添加路由 add</h4><p>可以添加一条可用路由，或添加一条要屏蔽的路由。</p>
<h5 id="添加主机路由"><a href="#添加主机路由" class="headerlink" title="添加主机路由"></a>添加主机路由</h5><p>添加主机路由时，需要指定网络 ID 和主机 ID，此时需要设置 <code>netmask 255.255.255.255</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route add -net 10.0.0.10 netmask 255.255.255.255 gw 10.139.128.1 dev eth0</span></span><br><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">10.0.0.10       10.139.128.1    255.255.255.255 UGH   0      0        0 eth0</span><br><span class="line">...123456</span><br></pre></td></tr></table></figure>
<h5 id="添加网络路由"><a href="#添加网络路由" class="headerlink" title="添加网络路由"></a>添加网络路由</h5><p>添加网络路由时，只需指定网络 ID，通过 <code>netmask</code> 设置掩码长度：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route add -net 10.0.0.0 netmask 255.255.255.0 gw 10.139.128.1 dev eth0</span></span><br><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">10.0.0.0        10.139.128.1    255.255.255.0   UG    0      0        0 eth0</span><br><span class="line">...123456</span><br></pre></td></tr></table></figure>
<h5 id="添加添加同一个局域网的主机"><a href="#添加添加同一个局域网的主机" class="headerlink" title="添加添加同一个局域网的主机"></a>添加添加同一个局域网的主机</h5><p>不指定 gw 选项时，添加的路由记录不使用网关：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route add -net 224.0.0.0 netmask 240.0.0.0 dev eth0</span></span><br><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route -n</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">224.0.0.0       0.0.0.0         240.0.0.0       U     0      0        0 eth0</span><br><span class="line">...123456</span><br></pre></td></tr></table></figure>
<h5 id="屏蔽路由"><a href="#屏蔽路由" class="headerlink" title="屏蔽路由"></a>屏蔽路由</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]# route add -net 224.0.0.0 netmask 240.0.0.0 reject</span><br><span class="line">[root@VM_139_74_centos ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">224.0.0.0       -               240.0.0.0       !     0      -        0 -</span><br><span class="line">...123456</span><br></pre></td></tr></table></figure>
<h4 id="删除路由记录"><a href="#删除路由记录" class="headerlink" title="删除路由记录"></a>删除路由记录</h4><p>跟添加路由类似，可以删除一条可用路由，或删除一条屏蔽的路由。</p>
<h5 id="删除可用路由"><a href="#删除可用路由" class="headerlink" title="删除可用路由"></a>删除可用路由</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route del -net 224.0.0.0 netmask 240.0.0.01</span><br></pre></td></tr></table></figure>
<h5 id="删除屏蔽的路由"><a href="#删除屏蔽的路由" class="headerlink" title="删除屏蔽的路由"></a>删除屏蔽的路由</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route del -net 224.0.0.0 netmask 240.0.0.0 reject1</span><br></pre></td></tr></table></figure>
<h3 id="删除和添加设置默认网关"><a href="#删除和添加设置默认网关" class="headerlink" title="删除和添加设置默认网关"></a>删除和添加设置默认网关</h3><p>添加或删除默认网关时，Linux 会自动检查网关的可用性：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route add default gw 192.168.1.1</span></span><br><span class="line">SIOCADDRT: Network is unreachable</span><br><span class="line">[root@VM_139_74_centos ~]<span class="comment"># route del default gw 192.168.1.1</span></span><br><span class="line">SIOCDELRT: No such process1234</span><br></pre></td></tr></table></figure>
<h3 id="ip-route和route命令"><a href="#ip-route和route命令" class="headerlink" title="ip route和route命令"></a>ip route和route命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ip route</span><br><span class="line">default via 172.16.0.1 dev ens192 proto static metric 100 </span><br><span class="line">172.16.0.0/16 dev ens192 proto kernel scope link src 172.16.1.11 metric 100 </span><br><span class="line">172.16.60.4 via 172.16.0.1 dev ens192 </span><br><span class="line">172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 </span><br><span class="line">172.18.0.0/16 dev br-dae2a5b9f054 proto kernel scope link src 172.18.0.1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.16.0.1      0.0.0.0         UG    100    0        0 ens192</span><br><span class="line">172.16.0.0      0.0.0.0         255.255.0.0     U     100    0        0 ens192</span><br><span class="line">172.16.60.4     172.16.0.1      255.255.255.255 UGH   0      0        0 ens192</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line">172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-dae2a5b9f054</span><br></pre></td></tr></table></figure>
<p>第一路由：表示去任何地方，都发送给网卡ens192，并经过网关172.16.0.1，发出。</p>
<p>第二路由：表示发往 172.16.0.0/16 这个网段的包，都由网卡ens192发出，src 172.16.1.11 表示，网卡ens192的ip是172.16.1.11，metric 100表示 路由距离，到达指定网络所需的中转数。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/Linux之tcpdump详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/Linux之tcpdump详解/" class="post-title-link" itemprop="url">Linux之tcpdump详解</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-09-22 13:43:31 / Modified: 13:55:28" itemprop="dateCreated datePublished" datetime="2020-09-22T13:43:31+08:00">2020-09-22</time>
            

            
              

              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/Linux之tcpdump详解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/Linux之tcpdump详解/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/Linux之tcpdump详解/" class="leancloud_visitors" data-flag-title="Linux之tcpdump详解">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">18k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">16 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="超详细的网络抓包神器-Tcpdump-使用指南"><a href="#超详细的网络抓包神器-Tcpdump-使用指南" class="headerlink" title="超详细的网络抓包神器 Tcpdump 使用指南"></a>超详细的网络抓包神器 Tcpdump 使用指南</h2><p><strong>前言</strong></p>
<blockquote>
<p>本文主要内容翻译自<strong>《Tcpdump Examples》[1]</strong>。</p>
</blockquote>
<p><code>tcpdump</code> 是一款强大的网络抓包工具，它使用 <code>libpcap</code> 库来抓取网络数据包，这个库在几乎在所有的 Linux/Unix 中都有。熟悉 tcpdump 的使用能够帮助你分析调试网络数据，本文将通过一个个具体的示例来介绍它在不同场景下的使用方法。不管你是系统管理员，程序员，云原生工程师还是 yaml 工程师，掌握 tcpdump 的使用都能让你如虎添翼，升职加薪。</p>
<h3 id="01基本语法和使用方法"><a href="#01基本语法和使用方法" class="headerlink" title="01基本语法和使用方法"></a>01基本语法和使用方法</h3><p><code>tcpdump</code> 的常用参数如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 -nn -s0 -v port <span class="number">80</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>-i</strong> : 选择要捕获的接口，通常是以太网卡或无线网卡，也可以是 <code>vlan</code> 或其他特殊接口。如果该系统上只有一个网络接口，则无需指定。</li>
<li><strong>-nn</strong> : 单个 n 表示不解析域名，直接显示 IP；两个 n 表示不解析域名和端口。这样不仅方便查看 IP 和端口号，而且在抓取大量数据时非常高效，因为<a href="https://cloud.tencent.com/product/cns?from=10680" target="_blank" rel="noopener">域名解析</a>会降低抓取速度。</li>
<li><strong>-s0</strong> : tcpdump 默认只会截取前 <code>96</code> 字节的内容，要想截取所有的报文内容，可以使用 <code>-s number</code>， <code>number</code> 就是你要截取的报文字节数，如果是 0 的话，表示截取报文全部内容。</li>
<li><strong>-v</strong> : 使用 <code>-v</code>，<code>-vv</code> 和 <code>-vvv</code> 来显示更多的详细信息，通常会显示更多与特定协议相关的信息。</li>
<li><code>port 80</code> : 这是一个常见的端口过滤器，表示仅抓取 <code>80</code> 端口上的流量，通常是 HTTP。</li>
</ul>
<p>额外再介绍几个常用参数：</p>
<ul>
<li><strong>-p</strong> : 不让网络接口进入混杂模式。默认情况下使用 tcpdump 抓包时，会让网络接口进入混杂模式。一般计算机网卡都工作在非混杂模式下，此时网卡只接受来自网络端口的目的地址指向自己的数据。当网卡工作在混杂模式下时，网卡将来自接口的所有数据都捕获并交给相应的驱动程序。如果设备接入的交换机开启了混杂模式，使用 <code>-p</code> 选项可以有效地过滤噪声。</li>
<li><strong>-e</strong> : 显示数据链路层信息。默认情况下 tcpdump 不会显示数据链路层信息，使用 <code>-e</code> 选项可以显示源和目的 MAC 地址，以及 VLAN tag 信息。例如：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n -e -c <span class="number">5</span> not ip6</span><br><span class="line"></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on br-lan, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.619865</span> <span class="number">24</span>:<span class="number">5</span>e:be:<span class="number">0</span>c:<span class="number">17</span>:af &gt; <span class="number">00</span>:e2:<span class="number">69</span>:<span class="number">23</span>:d3:<span class="number">3</span>b, ethertype IPv4 (<span class="number">0x0800</span>), length <span class="number">1162</span>: <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.51410</span> &gt; <span class="number">180.176</span><span class="number">.26</span><span class="number">.193</span><span class="number">.58695</span>: Flags [.], seq <span class="number">2045333376</span>:<span class="number">2045334484</span>, ack <span class="number">3398690514</span>, win <span class="number">751</span>, length <span class="number">1108</span></span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.626490</span> <span class="number">00</span>:e2:<span class="number">69</span>:<span class="number">23</span>:d3:<span class="number">3</span>b &gt; <span class="number">24</span>:<span class="number">5</span>e:be:<span class="number">0</span>c:<span class="number">17</span>:af, ethertype IPv4 (<span class="number">0x0800</span>), length <span class="number">68</span>: <span class="number">220.173</span><span class="number">.179</span><span class="number">.66</span><span class="number">.36017</span> &gt; <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.51410</span>: UDP, length <span class="number">26</span></span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.626893</span> <span class="number">24</span>:<span class="number">5</span>e:be:<span class="number">0</span>c:<span class="number">17</span>:af &gt; <span class="number">00</span>:e2:<span class="number">69</span>:<span class="number">23</span>:d3:<span class="number">3</span>b, ethertype IPv4 (<span class="number">0x0800</span>), length <span class="number">1444</span>: <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.51410</span> &gt; <span class="number">220.173</span><span class="number">.179</span><span class="number">.66</span><span class="number">.36017</span>: UDP, length <span class="number">1402</span></span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.628837</span> <span class="number">00</span>:e2:<span class="number">69</span>:<span class="number">23</span>:d3:<span class="number">3</span>b &gt; <span class="number">24</span>:<span class="number">5</span>e:be:<span class="number">0</span>c:<span class="number">17</span>:af, ethertype IPv4 (<span class="number">0x0800</span>), length <span class="number">1324</span>: <span class="number">46.97</span><span class="number">.169</span><span class="number">.182</span><span class="number">.6881</span> &gt; <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.59145</span>: Flags [P.], seq <span class="number">3058450381</span>:<span class="number">3058451651</span>, ack <span class="number">14349180</span>, win <span class="number">502</span>, length <span class="number">1270</span></span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.629096</span> <span class="number">24</span>:<span class="number">5</span>e:be:<span class="number">0</span>c:<span class="number">17</span>:af &gt; <span class="number">00</span>:e2:<span class="number">69</span>:<span class="number">23</span>:d3:<span class="number">3</span>b, ethertype IPv4 (<span class="number">0x0800</span>), length <span class="number">54</span>: <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.59145</span> &gt; <span class="number">192.168</span><span class="number">.100</span><span class="number">.1</span><span class="number">.12345</span>: Flags [.], ack <span class="number">3058451651</span>, win <span class="number">6350</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">5</span> packets captured</span><br></pre></td></tr></table></figure>
<h4 id="显示-ASCII-字符串"><a href="#显示-ASCII-字符串" class="headerlink" title="显示 ASCII 字符串"></a>显示 ASCII 字符串</h4><p><code>-A</code> 表示使用 <code>ASCII</code> 字符串打印报文的全部数据，这样可以使读取更加简单，方便使用 <code>grep</code> 等工具解析输出内容。<code>-X</code> 表示同时使用十六进制和 <code>ASCII</code> 字符串打印报文的全部数据。这两个参数不能一起使用。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -A -s0 port <span class="number">80</span></span><br></pre></td></tr></table></figure>
<h4 id="抓取特定协议的数据"><a href="#抓取特定协议的数据" class="headerlink" title="抓取特定协议的数据"></a>抓取特定协议的数据</h4><p>后面可以跟上协议名称来过滤特定协议的流量，以 UDP 为例，可以加上参数 udp 或 <code>protocol 17</code>，这两个命令意思相同。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 udp</span><br><span class="line">$ tcpdump -i eth0 proto <span class="number">17</span></span><br></pre></td></tr></table></figure>
<p>同理，tcp 与 <code>protocol 6</code> 意思相同。</p>
<h4 id="抓取特定主机的数据"><a href="#抓取特定主机的数据" class="headerlink" title="抓取特定主机的数据"></a>抓取特定主机的数据</h4><p>使用过滤器 <code>host</code> 可以抓取特定目的地和源 IP 地址的流量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 host <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>
<p>也可以使用 <code>src</code> 或 <code>dst</code> 只抓取源或目的地：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 dst <span class="number">10.10</span><span class="number">.1</span><span class="number">.20</span></span><br></pre></td></tr></table></figure>
<h4 id="将抓取的数据写入文件"><a href="#将抓取的数据写入文件" class="headerlink" title="将抓取的数据写入文件"></a>将抓取的数据写入文件</h4><p>使用 tcpdump 截取数据报文的时候，默认会打印到屏幕的默认输出，你会看到按照顺序和格式，很多的数据一行行快速闪过，根本来不及看清楚所有的内容。不过，tcpdump 提供了把截取的数据保存到文件的功能，以便后面使用其他图形工具（比如 wireshark，Snort）来分析。</p>
<p><code>-w</code> 选项用来把数据报文输出到文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 -s0 -w test.pcap</span><br></pre></td></tr></table></figure>
<h4 id="行缓冲模式"><a href="#行缓冲模式" class="headerlink" title="行缓冲模式"></a>行缓冲模式</h4><p>如果想实时将抓取到的数据通过管道传递给其他工具来处理，需要使用 <code>-l</code> 选项来开启行缓冲模式（或使用 <code>-c</code> 选项来开启数据包缓冲模式）。使用 <code>-l</code> 选项可以将输出通过立即发送给其他命令，其他命令会立即响应。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 -s0 -l port <span class="number">80</span> | grep <span class="string">'Server:'</span></span><br></pre></td></tr></table></figure>
<h4 id="组合过滤器"><a href="#组合过滤器" class="headerlink" title="组合过滤器"></a>组合过滤器</h4><p>过滤的真正强大之处在于你可以随意组合它们，而连接它们的逻辑就是常用的 <code>与/AND/&amp;&amp;</code> 、 <code>或/OR/||</code> 和 <code>非/not/!</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and or &amp;&amp;</span><br><span class="line">or or ||</span><br><span class="line">not or !</span><br></pre></td></tr></table></figure>
<h3 id="02过滤器"><a href="#02过滤器" class="headerlink" title="02过滤器"></a>02过滤器</h3><p>关于 tcpdump 的过滤器，这里有必要单独介绍一下。</p>
<p>机器上的网络报文数量异常的多，很多时候我们只关系和具体问题有关的数据报（比如访问某个网站的数据，或者 icmp 超时的报文等等），而这些数据只占到很小的一部分。把所有的数据截取下来，从里面找到想要的信息无疑是一件很费时费力的工作。而 tcpdump 提供了灵活的语法可以精确地截取关心的数据报，简化分析的工作量。这些选择数据包的语句就是过滤器（filter）！</p>
<h4 id="Host-过滤器"><a href="#Host-过滤器" class="headerlink" title="Host 过滤器"></a>Host 过滤器</h4><p>Host 过滤器用来过滤某个主机的数据报文。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump host <span class="number">1.2</span><span class="number">.3</span><span class="number">.4</span></span><br></pre></td></tr></table></figure>
<p>该命令会抓取所有发往主机 <code>1.2.3.4</code> 或者从主机 <code>1.2.3.4</code> 发出的流量。如果想只抓取从该主机发出的流量，可以使用下面的命令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump src host <span class="number">1.2</span><span class="number">.3</span><span class="number">.4</span></span><br></pre></td></tr></table></figure>
<h4 id="Network-过滤器"><a href="#Network-过滤器" class="headerlink" title="Network 过滤器"></a>Network 过滤器</h4><p>Network 过滤器用来过滤某个网段的数据，使用的是 <strong>CIDR[2]</strong> 模式。可以使用四元组（x.x.x.x）、三元组（x.x.x）、二元组（x.x）和一元组（x）。四元组就是指定某个主机，三元组表示子网掩码为 <code>255.255.255.0</code>，二元组表示子网掩码为 <code>255.255.0.0</code>，一元组表示子网掩码为 <code>255.0.0.0</code>。例如，</p>
<p>抓取所有发往网段 <code>192.168.1.x</code> 或从网段 <code>192.168.1.x</code> 发出的流量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump net <span class="number">192.168</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>
<p>抓取所有发往网段 <code>10.x.x.x</code> 或从网段 <code>10.x.x.x</code> 发出的流量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump net <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>和 Host 过滤器一样，这里也可以指定源和目的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump src net <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>也可以使用 CIDR 格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump src net <span class="number">172.16</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">12</span></span><br></pre></td></tr></table></figure>
<h4 id="Proto-过滤器"><a href="#Proto-过滤器" class="headerlink" title="Proto 过滤器"></a>Proto 过滤器</h4><p>Proto 过滤器用来过滤某个协议的数据，关键字为 <code>proto</code>，可省略。proto 后面可以跟上协议号或协议名称，支持 <code>icmp</code>, <code>igmp</code>, <code>igrp</code>, <code>pim</code>, <code>ah</code>, <code>esp</code>, <code>carp</code>, <code>vrrp</code>, <code>udp</code>和 <code>tcp</code>。因为通常的协议名称是保留字段，所以在与 proto 指令一起使用时，必须根据 shell 类型使用一个或两个反斜杠（/）来转义。Linux 中的 shell 需要使用两个反斜杠来转义，MacOS 只需要一个。</p>
<p>例如，抓取 icmp 协议的报文：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n proto \\icmp</span><br><span class="line"># 或者</span><br><span class="line">$ tcpdump -n icmp</span><br></pre></td></tr></table></figure>
<h4 id="Port-过滤器"><a href="#Port-过滤器" class="headerlink" title="Port 过滤器"></a>Port 过滤器</h4><p>Port 过滤器用来过滤通过某个端口的数据报文，关键字为 <code>port</code>。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump port <span class="number">389</span></span><br></pre></td></tr></table></figure>
<h3 id="03理解-tcpdump-的输出"><a href="#03理解-tcpdump-的输出" class="headerlink" title="03理解 tcpdump 的输出"></a>03理解 tcpdump 的输出</h3><p>截取数据只是第一步，第二步就是理解这些数据，下面就解释一下 tcpdump 命令输出各部分的意义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">06.995846</span> IP (tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">45646</span>, offset <span class="number">0</span>, flags [DF], proto TCP (<span class="number">6</span>), length <span class="number">64</span>)</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.106</span><span class="number">.56166</span> &gt; <span class="number">124.192</span><span class="number">.132</span><span class="number">.54</span><span class="number">.80</span>: Flags [S], cksum <span class="number">0xa730</span> (correct), seq <span class="number">992042666</span>, win <span class="number">65535</span>, options [mss <span class="number">1460</span>,nop,wscale <span class="number">4</span>,nop,nop,TS val <span class="number">663433143</span> ecr <span class="number">0</span>,sackOK,eol], length <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">07.030487</span> IP (tos <span class="number">0x0</span>, ttl <span class="number">51</span>, id <span class="number">0</span>, offset <span class="number">0</span>, flags [DF], proto TCP (<span class="number">6</span>), length <span class="number">44</span>)</span><br><span class="line">    <span class="number">124.192</span><span class="number">.132</span><span class="number">.54</span><span class="number">.80</span> &gt; <span class="number">192.168</span><span class="number">.1</span><span class="number">.106</span><span class="number">.56166</span>: Flags [S.], cksum <span class="number">0xedc0</span> (correct), seq <span class="number">2147006684</span>, ack <span class="number">992042667</span>, win <span class="number">14600</span>, options [mss <span class="number">1440</span>], length <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">07.030527</span> IP (tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">59119</span>, offset <span class="number">0</span>, flags [DF], proto TCP (<span class="number">6</span>), length <span class="number">40</span>)</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.106</span><span class="number">.56166</span> &gt; <span class="number">124.192</span><span class="number">.132</span><span class="number">.54</span><span class="number">.80</span>: Flags [.], cksum <span class="number">0x3e72</span> (correct), ack <span class="number">2147006685</span>, win <span class="number">65535</span>, length <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>最基本也是最重要的信息就是数据报的源地址/端口和目的地址/端口，上面的例子第一条数据报中，源地址 ip 是 <code>192.168.1.106</code>，源端口是 <code>56166</code>，目的地址是 <code>124.192.132.54</code>，目的端口是 <code>80</code>。<code>&gt;</code> 符号代表数据的方向。</p>
<p>此外，上面的三条数据还是 tcp 协议的三次握手过程，第一条就是 <code>SYN</code> 报文，这个可以通过 <code>Flags [S]</code> 看出。下面是常见的 TCP 报文的 Flags:</p>
<ul>
<li><code>[S]</code> : SYN（开始连接）</li>
<li><code>[.]</code> : 没有 Flag</li>
<li><code>[P]</code> : PSH（推送数据）</li>
<li><code>[F]</code> : FIN （结束连接）</li>
<li><code>[R]</code> : RST（重置连接）</li>
</ul>
<p>而第二条数据的 <code>[S.]</code> 表示 <code>SYN-ACK</code>，就是 <code>SYN</code> 报文的应答报文。</p>
<h3 id="04例子"><a href="#04例子" class="headerlink" title="04例子"></a>04例子</h3><p>下面给出一些具体的例子，每个例子都可以使用多种方法来获得相同的输出，你使用的方法取决于所需的输出和网络上的流量。我们在排障时，通常只想获取自己想要的内容，可以通过过滤器和 ASCII 输出并结合管道与 grep、cut、awk 等工具来实现此目的。</p>
<p>例如，在抓取 HTTP 请求和响应数据包时，可以通过删除标志 <code>SYN/ACK/FIN</code> 来过滤噪声，但还有更简单的方法，那就是通过管道传递给 <code>grep</code>。在达到目的的同时，我们要选择最简单最高效的方法。下面来看例子。</p>
<h4 id="提取-HTTP-用户代理"><a href="#提取-HTTP-用户代理" class="headerlink" title="提取 HTTP 用户代理"></a>提取 HTTP 用户代理</h4><p>从 HTTP 请求头中提取 HTTP 用户代理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -A -s1500 -l | grep <span class="string">"User-Agent:"</span></span><br></pre></td></tr></table></figure>
<p>通过 <code>egrep</code> 可以同时提取用户代理和主机名（或其他头文件）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -A -s1500 -l | egrep -i <span class="string">'User-Agent:|Host:'</span></span><br></pre></td></tr></table></figure>
<h4 id="只抓取-HTTP-GET-和-POST-流量"><a href="#只抓取-HTTP-GET-和-POST-流量" class="headerlink" title="只抓取 HTTP GET 和 POST 流量"></a>只抓取 HTTP GET 和 POST 流量</h4><p>抓取 HTTP GET 流量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s <span class="number">0</span> -A -vv <span class="string">'tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420'</span></span><br></pre></td></tr></table></figure>
<p>也可以抓取 HTTP POST 请求流量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s <span class="number">0</span> -A -vv <span class="string">'tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354'</span></span><br></pre></td></tr></table></figure>
<p>注意：该方法不能保证抓取到 HTTP POST 有效数据流量，因为一个 POST 请求会被分割为多个 TCP 数据包。</p>
<p>上述两个表达式中的十六进制将会与 GET 和 POST 请求的 <code>ASCII</code> 字符串匹配。例如，<code>tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4]</code> 首先会<strong>确定我们感兴趣的字节的位置[3]</strong>（在 TCP header 之后），然后选择我们希望匹配的 4 个字节。</p>
<h4 id="提取-HTTP-请求的-URL"><a href="#提取-HTTP-请求的-URL" class="headerlink" title="提取 HTTP 请求的 URL"></a>提取 HTTP 请求的 URL</h4><p>提取 HTTP 请求的主机名和路径：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s <span class="number">0</span> -v -n -l | egrep -i <span class="string">"POST /|GET /|Host:"</span></span><br><span class="line"></span><br><span class="line">tcpdump: listening on enp7s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line">	POST /wp-login.php HTTP/<span class="number">1.1</span></span><br><span class="line">	Host: dev.example.com</span><br><span class="line">	GET /wp-login.php HTTP/<span class="number">1.1</span></span><br><span class="line">	Host: dev.example.com</span><br><span class="line">	GET /favicon.ico HTTP/<span class="number">1.1</span></span><br><span class="line">	Host: dev.example.com</span><br><span class="line">	GET / HTTP/<span class="number">1.1</span></span><br><span class="line">	Host: dev.example.com</span><br></pre></td></tr></table></figure>
<h4 id="提取-HTTP-POST-请求中的密码"><a href="#提取-HTTP-POST-请求中的密码" class="headerlink" title="提取 HTTP POST 请求中的密码"></a>提取 HTTP POST 请求中的密码</h4><p>从 HTTP POST 请求中提取密码和主机名：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s <span class="number">0</span> -A -n -l | egrep -i <span class="string">"POST /|pwd=|passwd=|password=|Host:"</span></span><br><span class="line"></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on enp7s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">11</span>:<span class="number">25</span>:<span class="number">54.799014</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.30</span><span class="number">.39224</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.125</span><span class="number">.80</span>: Flags [P.], seq <span class="number">1458768667</span>:<span class="number">1458770008</span>, ack <span class="number">2440130792</span>, win <span class="number">704</span>, options [nop,nop,TS val <span class="number">461552632</span> ecr <span class="number">208900561</span>], length <span class="number">1341</span>: HTTP: POST /wp-login.php HTTP/<span class="number">1.1</span></span><br><span class="line">.....s..POST /wp-login.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: dev.example.com</span><br><span class="line">.....s..log=admin&amp;pwd=notmypassword&amp;wp-submit=Log+In&amp;redirect_to=http%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>Fdev.example.com%<span class="number">2</span>Fwp-admin%<span class="number">2</span>F&amp;testcookie=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="提取-Cookies"><a href="#提取-Cookies" class="headerlink" title="提取 Cookies"></a>提取 Cookies</h4><p>提取 <code>Set-Cookie</code>（服务端的 Cookie）和 <code>Cookie</code>（客户端的 Cookie）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -A -s0 -l | egrep -i <span class="string">'Set-Cookie|Host:|Cookie:'</span></span><br><span class="line"></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on wlp58s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line">Host: dev.example.com</span><br><span class="line">Cookie: wordpress_86be02xxxxxxxxxxxxxxxxxxxc43=admin%<span class="number">7</span>C152xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxfb3e15c744fdd6; _ga=GA1<span class="number">.2</span><span class="number">.21343434343421934</span>; _gid=GA1<span class="number">.2</span><span class="number">.927343434349426</span>; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_86be654654645645645654645653fc43=admin%<span class="number">7</span>C15275102testtesttesttestab7a61e; wp-settings-time<span class="number">-1</span>=<span class="number">1527337439</span></span><br></pre></td></tr></table></figure>
<h4 id="抓取-ICMP-数据包"><a href="#抓取-ICMP-数据包" class="headerlink" title="抓取 ICMP 数据包"></a>抓取 ICMP 数据包</h4><p>查看网络上的所有 ICMP 数据包：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n icmp</span><br><span class="line"></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on enp7s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">11</span>:<span class="number">34</span>:<span class="number">21.590380</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.217</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.30</span>: ICMP echo request, id <span class="number">27948</span>, seq <span class="number">1</span>, length <span class="number">64</span></span><br><span class="line"><span class="number">11</span>:<span class="number">34</span>:<span class="number">21.590434</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.30</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.217</span>: ICMP echo reply, id <span class="number">27948</span>, seq <span class="number">1</span>, length <span class="number">64</span></span><br><span class="line"><span class="number">11</span>:<span class="number">34</span>:<span class="number">27.680307</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.159</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span>: ICMP <span class="number">10.10</span><span class="number">.1</span><span class="number">.189</span> udp port <span class="number">59619</span> unreachable, length <span class="number">115</span></span><br></pre></td></tr></table></figure>
<h4 id="抓取非-ECHO-REPLY-类型的-ICMP-数据包"><a href="#抓取非-ECHO-REPLY-类型的-ICMP-数据包" class="headerlink" title="抓取非 ECHO/REPLY 类型的 ICMP 数据包"></a>抓取非 ECHO/REPLY 类型的 ICMP 数据包</h4><p>通过排除 echo 和 reply 类型的数据包使抓取到的数据包不包括标准的 <code>ping</code> 包：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump <span class="string">'icmp[icmptype] != icmp-echo and icmp[icmptype] != icmp-echoreply'</span></span><br><span class="line"></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on enp7s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">11</span>:<span class="number">37</span>:<span class="number">04.041037</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.189</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.20</span>: ICMP <span class="number">10.10</span><span class="number">.1</span><span class="number">.189</span> udp port <span class="number">36078</span> unreachable, length <span class="number">156</span></span><br></pre></td></tr></table></figure>
<h4 id="抓取-SMTP-POP3-协议的邮件"><a href="#抓取-SMTP-POP3-协议的邮件" class="headerlink" title="抓取 SMTP/POP3 协议的邮件"></a>抓取 SMTP/POP3 协议的邮件</h4><p>可以提取电子邮件的正文和其他数据。例如，只提取电子邮件的收件人：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -l port <span class="number">25</span> | grep -i <span class="string">'MAIL FROM\|RCPT TO'</span></span><br></pre></td></tr></table></figure>
<h4 id="抓取-NTP-服务的查询和响应"><a href="#抓取-NTP-服务的查询和响应" class="headerlink" title="抓取 NTP 服务的查询和响应"></a>抓取 NTP 服务的查询和响应</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump dst port <span class="number">123</span></span><br><span class="line"></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on eth0, link-type EN10MB (Ethernet), capture size <span class="number">65535</span> bytes</span><br><span class="line"><span class="number">21</span>:<span class="number">02</span>:<span class="number">19.112502</span> IP test33.ntp &gt; <span class="number">199.30</span><span class="number">.140</span><span class="number">.74</span>.ntp: NTPv4, Client, length <span class="number">48</span></span><br><span class="line"><span class="number">21</span>:<span class="number">02</span>:<span class="number">19.113888</span> IP <span class="number">216.239</span><span class="number">.35</span><span class="number">.0</span>.ntp &gt; test33.ntp: NTPv4, Server, length <span class="number">48</span></span><br><span class="line"><span class="number">21</span>:<span class="number">02</span>:<span class="number">20.150347</span> IP test33.ntp &gt; <span class="number">216.239</span><span class="number">.35</span><span class="number">.0</span>.ntp: NTPv4, Client, length <span class="number">48</span></span><br><span class="line"><span class="number">21</span>:<span class="number">02</span>:<span class="number">20.150991</span> IP <span class="number">216.239</span><span class="number">.35</span><span class="number">.0</span>.ntp &gt; test33.ntp: NTPv4, Server, length <span class="number">48</span></span><br></pre></td></tr></table></figure>
<h4 id="抓取-SNMP-服务的查询和响应"><a href="#抓取-SNMP-服务的查询和响应" class="headerlink" title="抓取 SNMP 服务的查询和响应"></a>抓取 SNMP 服务的查询和响应</h4><p>通过 SNMP 服务，渗透测试人员可以获取大量的设备和系统信息。在这些信息中，系统信息最为关键，如操作系统版本、内核版本等。使用 SNMP 协议快速扫描程序 <code>onesixtyone</code>，可以看到目标系统的信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ onesixtyone <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span> public</span><br><span class="line"></span><br><span class="line">Scanning <span class="number">1</span> hosts, <span class="number">1</span> communities</span><br><span class="line">10.10.1.10 [public] Linux test33 4.15.0-20-generic #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64</span><br></pre></td></tr></table></figure>
<p>可以通过 tcpdump 抓取 <code>GetRequest</code> 和 <code>GetResponse</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n -s0  port <span class="number">161</span> and udp</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on wlp58s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">23</span>:<span class="number">39</span>:<span class="number">13.725522</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.159</span><span class="number">.36826</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.20</span><span class="number">.161</span>:  GetRequest(<span class="number">28</span>)  <span class="number">.1</span><span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line"><span class="number">23</span>:<span class="number">39</span>:<span class="number">13.728789</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.20</span><span class="number">.161</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.159</span><span class="number">.36826</span>:  GetResponse(<span class="number">109</span>)  <span class="number">.1</span><span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span>=<span class="string">"Linux testmachine 4.15.0-20-generic #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64"</span></span><br></pre></td></tr></table></figure>
<h4 id="切割-pcap-文件"><a href="#切割-pcap-文件" class="headerlink" title="切割 pcap 文件"></a>切割 pcap 文件</h4><p>当抓取大量数据并写入文件时，可以自动切割为多个大小相同的文件。例如，下面的命令表示每 3600 秒创建一个新文件 <code>capture-(hour).pcap</code>，每个文件大小不超过 <code>200*1000000</code> 字节：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump  -w /tmp/capture-%H.pcap -G <span class="number">3600</span> -C <span class="number">200</span></span><br></pre></td></tr></table></figure>
<p>这些文件的命名为 <code>capture-{1-24}.pcap</code>，24 小时之后，之前的文件就会被覆盖。</p>
<h4 id="抓取-IPv6-流量"><a href="#抓取-IPv6-流量" class="headerlink" title="抓取 IPv6 流量"></a>抓取 IPv6 流量</h4><p>可以通过过滤器 <code>ip6</code> 来抓取 IPv6 流量，同时可以指定协议如 TCP：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn ip6 proto <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>从之前保存的文件中读取 IPv6 UDP 数据报文：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nr ipv6-test.pcap ip6 proto <span class="number">17</span></span><br></pre></td></tr></table></figure>
<h4 id="检测端口扫描"><a href="#检测端口扫描" class="headerlink" title="检测端口扫描"></a>检测端口扫描</h4><p>在下面的例子中，你会发现抓取到的报文的源和目的一直不变，且带有标志位 <code>[S]</code> 和 <code>[R]</code>，它们与一系列看似随机的目标端口进行匹配。当发送 <code>SYN</code> 之后，如果目标主机的端口没有打开，就会返回一个 <code>RESET</code>。这是 <code>Nmap</code> 等端口扫描工具的标准做法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn</span><br><span class="line"></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693601</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.60460</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.5432</span>: Flags [S], seq <span class="number">116466344</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090332</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693626</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.35470</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.513</span>: Flags [S], seq <span class="number">3400074709</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090332</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693762</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.44244</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.389</span>: Flags [S], seq <span class="number">2214070267</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090333</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693772</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.389</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.44244</span>: Flags [R.], seq <span class="number">0</span>, ack <span class="number">2214070268</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693783</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.35172</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.1433</span>: Flags [S], seq <span class="number">2358257571</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090333</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693826</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.33022</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49153</span>: Flags [S], seq <span class="number">2406028551</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090333</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695567</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.55130</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49154</span>: Flags [S], seq <span class="number">3230403372</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090334</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695590</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49154</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.55130</span>: Flags [R.], seq <span class="number">0</span>, ack <span class="number">3230403373</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695608</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.33460</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49152</span>: Flags [S], seq <span class="number">3289070068</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090335</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695622</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49152</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.33460</span>: Flags [R.], seq <span class="number">0</span>, ack <span class="number">3289070069</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695637</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.34940</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.1029</span>: Flags [S], seq <span class="number">140319147</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090335</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695650</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.1029</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.34940</span>: Flags [R.], seq <span class="number">0</span>, ack <span class="number">140319148</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695664</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.45648</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.5060</span>: Flags [S], seq <span class="number">2203629201</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090335</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695775</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.49028</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.2000</span>: Flags [S], seq <span class="number">635990431</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,TS val <span class="number">3547090335</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695790</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.2000</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.49028</span>: Flags [R.], seq <span class="number">0</span>, ack <span class="number">635990432</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="过滤-Nmap-NSE-脚本测试结果"><a href="#过滤-Nmap-NSE-脚本测试结果" class="headerlink" title="过滤 Nmap NSE 脚本测试结果"></a>过滤 Nmap NSE 脚本测试结果</h4><p>本例中 Nmap NSE 测试脚本 <code>http-enum.nse</code> 用来检测 HTTP 服务的合法 URL。</p>
<p>在执行脚本测试的主机上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nmap -p <span class="number">80</span> --script=http-enum.nse targetip</span><br></pre></td></tr></table></figure>
<p>在目标主机上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn port <span class="number">80</span> | grep <span class="string">"GET /"</span></span><br><span class="line"></span><br><span class="line">GET /w3perl/ HTTP/<span class="number">1.1</span></span><br><span class="line">GET /w-agora/ HTTP/<span class="number">1.1</span></span><br><span class="line">GET /way-board/ HTTP/<span class="number">1.1</span></span><br><span class="line">GET /web800fo/ HTTP/<span class="number">1.1</span></span><br><span class="line">GET /webaccess/ HTTP/<span class="number">1.1</span></span><br><span class="line">GET /webadmin/ HTTP/<span class="number">1.1</span></span><br><span class="line">GET /webAdmin/ HTTP/<span class="number">1.1</span></span><br></pre></td></tr></table></figure>
<h4 id="抓取-DNS-请求和响应"><a href="#抓取-DNS-请求和响应" class="headerlink" title="抓取 DNS 请求和响应"></a>抓取 DNS 请求和响应</h4><p>向 Google 公共 DNS 发起的出站 <code>DNS</code> 请求和 A 记录响应可以通过 tcpdump 抓取到：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i wlp58s0 -s0 port <span class="number">53</span></span><br><span class="line"></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on wlp58s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">14</span>:<span class="number">19</span>:<span class="number">06.879799</span> IP test<span class="number">.53852</span> &gt; google-public-dns-a.google.com.domain: <span class="number">26977</span>+ [<span class="number">1</span>au] A? play.google.com. (<span class="number">44</span>)</span><br><span class="line"><span class="number">14</span>:<span class="number">19</span>:<span class="number">07.022618</span> IP google-public-dns-a.google.com.domain &gt; test<span class="number">.53852</span>: <span class="number">26977</span> <span class="number">1</span>/<span class="number">0</span>/<span class="number">1</span> A <span class="number">216.58</span><span class="number">.203</span><span class="number">.110</span> (<span class="number">60</span>)</span><br></pre></td></tr></table></figure>
<h4 id="抓取-HTTP-有效数据包"><a href="#抓取-HTTP-有效数据包" class="headerlink" title="抓取 HTTP 有效数据包"></a>抓取 HTTP 有效数据包</h4><p>抓取 80 端口的 HTTP 有效数据包，排除 TCP 连接建立过程的数据包（SYN / FIN / ACK）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump <span class="string">'tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)'</span></span><br></pre></td></tr></table></figure>
<h4 id="将输出内容重定向到-Wireshark"><a href="#将输出内容重定向到-Wireshark" class="headerlink" title="将输出内容重定向到 Wireshark"></a>将输出内容重定向到 Wireshark</h4><p>通常 <code>Wireshark</code>（或 tshark）比 tcpdump 更容易分析应用层协议。一般的做法是在远程服务器上先使用 <code>tcpdump</code> 抓取数据并写入文件，然后再将文件拷贝到本地工作站上用 <code>Wireshark</code> 分析。</p>
<p>还有一种更高效的方法，可以通过 ssh 连接将抓取到的数据实时发送给 Wireshark 进行分析。以 MacOS 系统为例，可以通过 <code>brew cask install wireshark</code> 来安装，然后通过下面的命令来分析：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@remotesystem <span class="string">'tcpdump -s0 -c 1000 -nn -w - not port 22'</span> | <span class="regexp">/Applications/</span>Wireshark.app/Contents/MacOS/Wireshark -k -i -</span><br></pre></td></tr></table></figure>
<p>例如，如果想分析 DNS 协议，可以使用下面的命令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@remotesystem <span class="string">'tcpdump -s0 -c 1000 -nn -w - port 53'</span> | <span class="regexp">/Applications/</span>Wireshark.app/Contents/MacOS/Wireshark -k -i -</span><br></pre></td></tr></table></figure>
<p>抓取到的数据：</p>
<p><code>-c</code> 选项用来限制抓取数据的大小。如果不限制大小，就只能通过 <code>ctrl-c</code> 来停止抓取，这样一来不仅关闭了 tcpdump，也关闭了 wireshark。</p>
<h4 id="找出发包最多的-IP"><a href="#找出发包最多的-IP" class="headerlink" title="找出发包最多的 IP"></a>找出发包最多的 IP</h4><p>找出一段时间内发包最多的 IP，或者从一堆报文中找出发包最多的 IP，可以使用下面的命令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nnn -t -c <span class="number">200</span> | cut -f <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> -d <span class="string">'.'</span> | sort | uniq -c | sort -nr | head -n <span class="number">20</span></span><br><span class="line"></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on enp7s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">200</span> packets captured</span><br><span class="line"><span class="number">261</span> packets received by filter</span><br><span class="line"><span class="number">0</span> packets dropped by kernel</span><br><span class="line">    <span class="number">108</span> IP <span class="number">10.10</span><span class="number">.211</span><span class="number">.181</span></span><br><span class="line">     <span class="number">91</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.30</span></span><br><span class="line">      <span class="number">1</span> IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.50</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>cut -f 1,2,3,4 -d ‘.’</strong> : 以 <code>.</code> 为分隔符，打印出每行的前四列。即 IP 地址。</li>
<li><strong>sort | uniq -c</strong> : 排序并计数</li>
<li><strong>sort -nr</strong> : 按照数值大小逆向排序</li>
</ul>
<h4 id="抓取用户名和密码"><a href="#抓取用户名和密码" class="headerlink" title="抓取用户名和密码"></a>抓取用户名和密码</h4><p>本例将重点放在标准纯文本协议上，过滤出于用户名和密码相关的报文：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump port http or port ftp or port smtp or port imap or port pop3 or port telnet -l -A | egrep -i -B5 <span class="string">'pass=|pwd=|log=|login=|user=|username=|pw=|passw=|passwd=|password=|pass:|user:|username:|password:|login:|pass |user '</span></span><br></pre></td></tr></table></figure>
<h4 id="抓取-DHCP-报文"><a href="#抓取-DHCP-报文" class="headerlink" title="抓取 DHCP 报文"></a>抓取 DHCP 报文</h4><p>最后一个例子，抓取 DHCP 服务的请求和响应报文，67 为 DHCP 端口，68 为客户机端口。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -v -n port <span class="number">67</span> or <span class="number">68</span></span><br><span class="line"></span><br><span class="line">tcpdump: listening on enp7s0, link-type EN10MB (Ethernet), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">14</span>:<span class="number">37</span>:<span class="number">50.059662</span> IP (tos <span class="number">0x10</span>, ttl <span class="number">128</span>, id <span class="number">0</span>, offset <span class="number">0</span>, flags [none], proto UDP (<span class="number">17</span>), length <span class="number">328</span>)</span><br><span class="line">    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="number">.68</span> &gt; <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span><span class="number">.67</span>: BOOTP/DHCP, Request <span class="keyword">from</span> <span class="number">00</span>:<span class="number">0</span>c:xx:xx:xx:d5, length <span class="number">300</span>, xid <span class="number">0xc9779c2a</span>, Flags [none]</span><br><span class="line">	  Client-Ethernet-Address <span class="number">00</span>:<span class="number">0</span>c:xx:xx:xx:d5</span><br><span class="line">	  Vendor-rfc1048 Extensions</span><br><span class="line">	    Magic Cookie <span class="number">0x63825363</span></span><br><span class="line">	    DHCP-Message Option <span class="number">53</span>, length <span class="number">1</span>: Request</span><br><span class="line">	    Requested-IP Option <span class="number">50</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.163</span></span><br><span class="line">	    Hostname Option <span class="number">12</span>, length <span class="number">14</span>: <span class="string">"test-ubuntu"</span></span><br><span class="line">	    Parameter-Request Option <span class="number">55</span>, length <span class="number">16</span>:</span><br><span class="line">	      Subnet-Mask, BR, Time-Zone, Default-Gateway</span><br><span class="line">	      Domain-Name, Domain-Name-Server, Option <span class="number">119</span>, Hostname</span><br><span class="line">	      Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route</span><br><span class="line">	      NTP, Classless-Static-Route-Microsoft, Static-Route, Option <span class="number">252</span></span><br><span class="line"><span class="number">14</span>:<span class="number">37</span>:<span class="number">50.059667</span> IP (tos <span class="number">0x10</span>, ttl <span class="number">128</span>, id <span class="number">0</span>, offset <span class="number">0</span>, flags [none], proto UDP (<span class="number">17</span>), length <span class="number">328</span>)</span><br><span class="line">    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="number">.68</span> &gt; <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span><span class="number">.67</span>: BOOTP/DHCP, Request <span class="keyword">from</span> <span class="number">00</span>:<span class="number">0</span>c:xx:xx:xx:d5, length <span class="number">300</span>, xid <span class="number">0xc9779c2a</span>, Flags [none]</span><br><span class="line">	  Client-Ethernet-Address <span class="number">00</span>:<span class="number">0</span>c:xx:xx:xx:d5</span><br><span class="line">	  Vendor-rfc1048 Extensions</span><br><span class="line">	    Magic Cookie <span class="number">0x63825363</span></span><br><span class="line">	    DHCP-Message Option <span class="number">53</span>, length <span class="number">1</span>: Request</span><br><span class="line">	    Requested-IP Option <span class="number">50</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.163</span></span><br><span class="line">	    Hostname Option <span class="number">12</span>, length <span class="number">14</span>: <span class="string">"test-ubuntu"</span></span><br><span class="line">	    Parameter-Request Option <span class="number">55</span>, length <span class="number">16</span>:</span><br><span class="line">	      Subnet-Mask, BR, Time-Zone, Default-Gateway</span><br><span class="line">	      Domain-Name, Domain-Name-Server, Option <span class="number">119</span>, Hostname</span><br><span class="line">	      Netbios-Name-Server, Netbios-Scope, MTU, Classless-Static-Route</span><br><span class="line">	      NTP, Classless-Static-Route-Microsoft, Static-Route, Option <span class="number">252</span></span><br><span class="line"><span class="number">14</span>:<span class="number">37</span>:<span class="number">50.060780</span> IP (tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">53564</span>, offset <span class="number">0</span>, flags [none], proto UDP (<span class="number">17</span>), length <span class="number">339</span>)</span><br><span class="line">    <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span><span class="number">.67</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.163</span><span class="number">.68</span>: BOOTP/DHCP, Reply, length <span class="number">311</span>, xid <span class="number">0xc9779c2a</span>, Flags [none]</span><br><span class="line">	  Your-IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.163</span></span><br><span class="line">	  Server-IP <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">	  Client-Ethernet-Address <span class="number">00</span>:<span class="number">0</span>c:xx:xx:xx:d5</span><br><span class="line">	  Vendor-rfc1048 Extensions</span><br><span class="line">	    Magic Cookie <span class="number">0x63825363</span></span><br><span class="line">	    DHCP-Message Option <span class="number">53</span>, length <span class="number">1</span>: ACK</span><br><span class="line">	    Server-ID Option <span class="number">54</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">	    Lease-Time Option <span class="number">51</span>, length <span class="number">4</span>: <span class="number">86400</span></span><br><span class="line">	    RN Option <span class="number">58</span>, length <span class="number">4</span>: <span class="number">43200</span></span><br><span class="line">	    RB Option <span class="number">59</span>, length <span class="number">4</span>: <span class="number">75600</span></span><br><span class="line">	    Subnet-Mask Option <span class="number">1</span>, length <span class="number">4</span>: <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">	    BR Option <span class="number">28</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.255</span></span><br><span class="line">	    Domain-Name-Server Option <span class="number">6</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">	    Hostname Option <span class="number">12</span>, length <span class="number">14</span>: <span class="string">"test-ubuntu"</span></span><br><span class="line">	    T252 Option <span class="number">252</span>, length <span class="number">1</span>: <span class="number">10</span></span><br><span class="line">	    Default-Gateway Option <span class="number">3</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>
<h3 id="05总结"><a href="#05总结" class="headerlink" title="05总结"></a>05总结</h3><p>本文主要介绍了 <code>tcpdump</code> 的基本语法和使用方法，并通过一些示例来展示它强大的过滤功能。将 tcpdump 与 wireshark 进行组合可以发挥更强大的功效，本文也展示了如何优雅顺滑地结合 tcpdump 和 wireshark。如果你想了解更多的细节，可以查看 tcpdump 的 <code>man</code> 手册。</p>
<p><code>本文转截: https://cloud.tencent.com/developer/article/1589827</code></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/Kubernetes安装-kubeadm-1-17-1-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/Kubernetes安装-kubeadm-1-17-1-18/" class="post-title-link" itemprop="url">Kubernetes安装-kubeadm-1.17/1.18</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-09-19 09:50:06 / Modified: 16:32:52" itemprop="dateCreated datePublished" datetime="2020-09-19T09:50:06+08:00">2020-09-19</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/Kubernetes安装-kubeadm-1-17-1-18/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/Kubernetes安装-kubeadm-1-17-1-18/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/Kubernetes安装-kubeadm-1-17-1-18/" class="leancloud_visitors" data-flag-title="Kubernetes安装-kubeadm-1.17/1.18">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">5.9k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">5 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>离线包下载</p>
<p>在没有互联网到企业内网部署Kubernetes集群</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>CentOS Linux release 7.8.2003 (Core)</li>
<li>Docker 19.03.5</li>
<li>Kubernetes 1.17.1/1.18.0</li>
</ul>
<h2 id="准备安装包"><a href="#准备安装包" class="headerlink" title="准备安装包"></a>准备安装包</h2><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul>
<li>在这里<a href="https://docs.docker.com/engine/release-notes/" target="_blank" rel="noopener">查看Docker最新发布的版本号</a></li>
</ul>
<h3 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h3><ul>
<li>最新版本号：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fstorage.googleapis.com%2Fkubernetes-release%2Frelease%2Fstable.txt" target="_blank" rel="noopener">https://storage.googleapis.com/kubernetes-release/release/stable.txt</a></li>
<li>版本发型说明：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes.io%2Fdocs%2Fsetup%2Frelease%2Fnotes" target="_blank" rel="noopener">https://kubernetes.io/docs/setup/release/notes</a></li>
</ul>
<h3 id="使用yum获取依赖包"><a href="#使用yum获取依赖包" class="headerlink" title="使用yum获取依赖包"></a>使用yum获取依赖包</h3><p>首先在一台能联网Centos 7中下载依赖包</p>
<p>PS：注意这个系统要是全新minimal安装的，干净的，如果已经通过yum安装过一些软件，下载的依赖包可能不完整。</p>
<ul>
<li>Centos 7 minimal下载地址：<a href="http://mirrors.aliyun.com/centos/7.7.1908/isos/x86_64/CentOS-7-x86_64-Minimal-1908.iso" target="_blank" rel="noopener">http://mirrors.aliyun.com/centos/7.7.1908/isos/x86_64/CentOS-7-x86_64-Minimal-1908.iso</a></li>
</ul>
<p>/root/下创建一个packages目录，所有依赖包会下载到<code>/root/packages</code>目录。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /root/packages/docker</span><br><span class="line">mkdir -p /root/packages/kubernetes</span><br><span class="line">mkdir -p /root/packages/<span class="built_in">source</span></span><br><span class="line">mkdir -p /root/packages/images</span><br><span class="line">mkdir -p /root/packages/plugins</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用阿里云镜像源</span></span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地仓库包，用来创建本地仓库用的</span></span><br><span class="line">yum install --downloadonly --downloaddir=/root/packages/<span class="built_in">source</span> \</span><br><span class="line">    createrepo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实用工具，不做共享存储的话，nfs可不下载。</span></span><br><span class="line">yum install --downloadonly --downloaddir=/root/packages/<span class="built_in">source</span> \</span><br><span class="line">    yum-utils \</span><br><span class="line">    nfs-utils \</span><br><span class="line">    wget</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 时间同步</span></span><br><span class="line">yum install --downloadonly --downloaddir=/root/packages/<span class="built_in">source</span> \</span><br><span class="line">    chrony</span><br><span class="line"></span><br><span class="line"><span class="comment"># HAProxy 和 KeepAlived，一般做高可用安装包</span></span><br><span class="line">yum install --downloadonly --downloaddir=/root/packages/<span class="built_in">source</span> \</span><br><span class="line">    haproxy \</span><br><span class="line">    keepalived</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker 依赖包</span></span><br><span class="line">yum install -y --downloadonly --downloaddir=/root/packages/docker \</span><br><span class="line">    device-mapper-persistent-data \</span><br><span class="line">    lvm2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加阿里云Docker源</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker</span></span><br><span class="line">yum install -y --downloadonly --downloaddir=/root/packages/docker \</span><br><span class="line">    docker-ce-19.03.5 \</span><br><span class="line">    docker-ce-cli-19.03.5 \</span><br><span class="line">    containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置K8S的yum源</span></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubelet/kubeadm/kubectl(版本自选)</span></span><br><span class="line">yum install -y --downloadonly --downloaddir=/root/packages/kubernetes \</span><br><span class="line">    kubelet-1.18.0 \</span><br><span class="line">    kubeadm-1.18.0 \</span><br><span class="line">    kubectl-1.18.0</span><br></pre></td></tr></table></figure>
<h3 id="获取kubeadm依赖镜像"><a href="#获取kubeadm依赖镜像" class="headerlink" title="获取kubeadm依赖镜像"></a>获取kubeadm依赖镜像</h3><p>离线包下载完成后，准备获取kubeadm用到的镜像列表，这步操作要在一台安装好Docker环境的计算机上进行，拉取完成后打包复制到资源包<code>/root/packages/images</code>目录中。</p>
<p>如果安装了kubeadm，可使用一下命令获取kubernetes镜像。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images <span class="built_in">list</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- k8s.gcr.io/kube-apiserver:v1.18.0</span><br><span class="line">- k8s.gcr.io/kube-controller-manager:v1.18.0</span><br><span class="line">- k8s.gcr.io/kube-scheduler:v1.18.0</span><br><span class="line">- k8s.gcr.io/kube-proxy:v1.18.0</span><br><span class="line">- k8s.gcr.io/pause:3.2</span><br><span class="line">- k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">- k8s.gcr.io/coredns:1.6.7</span><br></pre></td></tr></table></figure>
<p>国内拉阿里云对应镜像。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从阿里云拉取镜像</span></span><br><span class="line">docker pull registry.cn-qingdao.aliyuncs.com/kubernetes-image/kube-apiserver:v1.18.0</span><br><span class="line">docker pull registry.cn-qingdao.aliyuncs.com/kubernetes-image/kube-controller-manager:v1.18.0</span><br><span class="line">docker pull registry.cn-qingdao.aliyuncs.com/kubernetes-image/kube-scheduler:v1.18.0</span><br><span class="line">docker pull registry.cn-qingdao.aliyuncs.com/kubernetes-image/kube-proxy:v1.18.0</span><br><span class="line">docker pull registry.cn-qingdao.aliyuncs.com/kubernetes-image/pause:3.2</span><br><span class="line">docker pull registry.cn-qingdao.aliyuncs.com/kubernetes-image/etcd:3.4.3-0</span><br><span class="line">docker pull registry.cn-qingdao.aliyuncs.com/kubernetes-image/coredns:1.6.7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新tag镜像</span></span><br><span class="line">docker images \</span><br><span class="line">    | grep registry.cn-qingdao.aliyuncs.com/kubernetes-image \</span><br><span class="line">    | sed <span class="string">'s/registry.cn-qingdao.aliyuncs.com\/kubernetes-image/k8s.gcr.io/'</span> \</span><br><span class="line">    | awk <span class="string">'&#123;print "docker tag " $3 " " $1 ":" $2&#125;'</span> \</span><br><span class="line">    | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除旧镜像</span></span><br><span class="line">docker images \</span><br><span class="line">    | grep registry.cn-qingdao.aliyuncs.com/kubernetes-image \</span><br><span class="line">    | awk <span class="string">'&#123;print "docker rmi " $1 ":" $2&#125;'</span> \</span><br><span class="line">    | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 /root/packages/images 目录下导出镜像为压缩包</span></span><br><span class="line">docker save -o kube-controller-manager-v1.18.0.tar k8s.gcr.io/kube-controller-manager:v1.18.0</span><br><span class="line">docker save -o kube-apiserver-v1.18.0.tar k8s.gcr.io/kube-apiserver:v1.18.0</span><br><span class="line">docker save -o kube-scheduler-v1.18.0.tar k8s.gcr.io/kube-scheduler:v1.18.0</span><br><span class="line">docker save -o kube-proxy-v1.18.0.tar k8s.gcr.io/kube-proxy:v1.18.0</span><br><span class="line">docker save -o coredns-1.6.7.tar k8s.gcr.io/coredns:1.6.7</span><br><span class="line">docker save -o etcd-3.4.3-0.tar k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">docker save -o pause-3.2.tar k8s.gcr.io/pause:3.2</span><br></pre></td></tr></table></figure>
<h3 id="calico网络插件依赖镜像"><a href="#calico网络插件依赖镜像" class="headerlink" title="calico网络插件依赖镜像"></a>calico网络插件依赖镜像</h3><p>从<a href="https://docs.projectcalico.org/v3.10/getting-started/kubernetes/" target="_blank" rel="noopener">Quickstart for Calico on Kubernetes</a>找到<code>calico.yaml</code>文件，命名为<code>calico-v3.10.3.yaml</code>保存到资源包<code>/root/packages/plugins</code>目录中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat calico-v3.10.3.yaml | grep image: | awk <span class="string">'&#123;print $2&#125;'</span></span><br></pre></td></tr></table></figure>
<p>从文件中搜索<code>image</code>关键字找到如下依赖镜像。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- calico/cni:v3.10.3</span><br><span class="line">- calico/pod2daemon-flexvol:v3.10.3</span><br><span class="line">- calico/node:v3.10.3</span><br><span class="line">- calico/kube-controllers:v3.10.3</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取全部镜像</span></span><br><span class="line">cat calico-v3.10.3.yaml \</span><br><span class="line">    | grep image: \</span><br><span class="line">    | awk <span class="string">'&#123;print "docker pull " $2&#125;'</span> \</span><br><span class="line">    | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 /root/packages/images 目录下导出镜像为压缩包</span></span><br><span class="line">docker save -o calico-cni-v3.10.3.tar calico/cni:v3.10.3</span><br><span class="line">docker save -o calico-pod2daemon-flexvol-v3.10.3.tar calico/pod2daemon-flexvol:v3.10.3</span><br><span class="line">docker save -o calico-node-v3.10.3.tar calico/node:v3.10.3</span><br><span class="line">docker save -o calico-kube-controllers-v3.10.3.tar calico/kube-controllers:v3.10.3</span><br></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="1、kubernetes-dashboard"><a href="#1、kubernetes-dashboard" class="headerlink" title="1、kubernetes dashboard"></a>1、kubernetes dashboard</h4><p>从GitHub上找到Dashboard最新版本部署文件。</p>
<ul>
<li>Dashboard版本发布地址：<a href="https://github.com/kubernetes/dashboard/releases" target="_blank" rel="noopener">https://github.com/kubernetes/dashboard/releases</a></li>
</ul>
<h4 id="2、NGINX-Ingress-Controller"><a href="#2、NGINX-Ingress-Controller" class="headerlink" title="2、NGINX Ingress Controller"></a>2、NGINX Ingress Controller</h4><p>同样在官方网站找到部署<code>yaml</code>文件，并获取镜像列。</p>
<ul>
<li><a href="https://kubernetes.github.io/ingress-nginx/deploy/" target="_blank" rel="noopener">https://kubernetes.github.io/ingress-nginx/deploy/</a></li>
</ul>
<h2 id="准备工作后，离线安装"><a href="#准备工作后，离线安装" class="headerlink" title="准备工作后，离线安装"></a>准备工作后，离线安装</h2><h3 id="环境-1"><a href="#环境-1" class="headerlink" title="环境"></a>环境</h3><ul>
<li>Master节点 192.168.1.30</li>
<li>Worker节点 192.168.1.31</li>
</ul>
<h3 id="安装Master"><a href="#安装Master" class="headerlink" title="安装Master"></a>安装Master</h3><p>在<code>master</code>节点上执行。</p>
<ol>
<li><code>scp</code>命令上传资源包到<code>/root</code>目录下解压，<code>192.168.1.30</code>改为你节点的IP。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp packages.tar root@192.168.1.30:/root/</span><br></pre></td></tr></table></figure>
<ol>
<li>解压到<code>/root/packages</code>目录</li>
</ol>
<p><strong>注意</strong>：解压路径不能修改。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/packages</span><br><span class="line">tar -xzvf packages.tar -C /root/packages</span><br></pre></td></tr></table></figure>
<ol>
<li>设置参数并安装</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># master节点的主机名</span></span><br><span class="line"><span class="built_in">export</span> HOSTNAMES=k8smaster</span><br><span class="line"><span class="comment"># kubernetes apiserver的主机地址</span></span><br><span class="line"><span class="built_in">export</span> APISERVER_NAME=192.168.1.30</span><br><span class="line"><span class="comment"># 镜像仓库私有仓库名，默认k8s.gcr.io</span></span><br><span class="line"><span class="built_in">export</span> IMAGEREPO=&lt;harbor_address&gt;/kubernetes-image</span><br><span class="line"><span class="comment"># Pod 使用的网段</span></span><br><span class="line"><span class="built_in">export</span> PODSUBNET=10.11.0.0/16</span><br><span class="line"><span class="comment"># etcd数据路径，默认/var/lib/etcd</span></span><br><span class="line"><span class="built_in">export</span> ETCD_DIR=/home/etcd</span><br><span class="line"><span class="comment"># kube的版本信息</span></span><br><span class="line"><span class="built_in">export</span> KUBEVERSION=v1.18.0</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/packages</span><br><span class="line">./main_master.sh</span><br></pre></td></tr></table></figure>
<h3 id="安装Worker"><a href="#安装Worker" class="headerlink" title="安装Worker"></a>安装Worker</h3><p>如果需要添加节点的话，在<code>worker</code>节点上执行。。。。</p>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><h4 id="Pod启动报镜像拉取失败"><a href="#Pod启动报镜像拉取失败" class="headerlink" title="Pod启动报镜像拉取失败"></a>Pod启动报镜像拉取失败</h4><p>有些部署文件中设置了镜像拉取策略为<code>imagePullPolicy:Always</code>，意思是每次启动都要拉取镜像，修改为<code>imagePullPolicy:IfNotPresent</code>如果不存在才拉取就行了，或者搭建私有仓库亦可。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/设计篇之Paas基础学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/设计篇之Paas基础学习/" class="post-title-link" itemprop="url">设计篇之Paas基础学习</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-30 21:14:25 / Modified: 22:53:01" itemprop="dateCreated datePublished" datetime="2020-06-30T21:14:25+08:00">2020-06-30</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Paas/" itemprop="url" rel="index"><span itemprop="name">Paas</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/设计篇之Paas基础学习/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/设计篇之Paas基础学习/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/设计篇之Paas基础学习/" class="leancloud_visitors" data-flag-title="设计篇之Paas基础学习">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">0</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">1 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/Golang碎片之http包/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/Golang碎片之http包/" class="post-title-link" itemprop="url">Golang碎片之http包</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-30 21:11:01 / Modified: 21:51:18" itemprop="dateCreated datePublished" datetime="2020-06-30T21:11:01+08:00">2020-06-30</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/Golang碎片之http包/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/Golang碎片之http包/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/Golang碎片之http包/" class="leancloud_visitors" data-flag-title="Golang碎片之http包">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">0</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">1 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/Golang碎片之GPM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/Golang碎片之GPM/" class="post-title-link" itemprop="url">Golang碎片之GPM</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-30 21:09:51 / Modified: 21:37:30" itemprop="dateCreated datePublished" datetime="2020-06-30T21:09:51+08:00">2020-06-30</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/Golang碎片之GPM/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/Golang碎片之GPM/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/Golang碎片之GPM/" class="leancloud_visitors" data-flag-title="Golang碎片之GPM">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">0</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">1 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/网络爬虫系列一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/网络爬虫系列一/" class="post-title-link" itemprop="url">网络爬虫系列一</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-29 21:15:45" itemprop="dateCreated datePublished" datetime="2020-06-29T21:15:45+08:00">2020-06-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-30 22:53:07" itemprop="dateModified" datetime="2020-06-30T22:53:07+08:00">2020-06-30</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/网络爬虫系列一/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/网络爬虫系列一/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/网络爬虫系列一/" class="leancloud_visitors" data-flag-title="网络爬虫系列一">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">0</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">1 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/网络学习篇之TCP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/passages/网络学习篇之TCP/" class="post-title-link" itemprop="url">网络学习篇之TCP</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-06-28 21:11:47" itemprop="dateCreated datePublished" datetime="2020-06-28T21:11:47+08:00">2020-06-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-06-30 22:53:13" itemprop="dateModified" datetime="2020-06-30T22:53:13+08:00">2020-06-30</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/passages/网络学习篇之TCP/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/passages/网络学习篇之TCP/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/passages/网络学习篇之TCP/" class="leancloud_visitors" data-flag-title="网络学习篇之TCP">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">2.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">2 mins.</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="TCP三次握手和四次挥手以及11种状态"><a href="#TCP三次握手和四次挥手以及11种状态" class="headerlink" title="TCP三次握手和四次挥手以及11种状态"></a>TCP三次握手和四次挥手以及11种状态</h2><h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><p>置位概念：根据TCP的包头字段，存在3个重要的标识ACK、SYN、FIN</p>
<blockquote>
<p>ACK：表示验证字段 SYN：位数置1，表示建立TCP连接 FIN：位数置1，表示断开TCP连接</p></blockquote>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/passages/网络学习篇之TCP/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Sheldon Lu">
            
              <p class="site-author-name" itemprop="name">Sheldon Lu</p>
              <div class="site-description motion-element" itemprop="description">静下心来写点东西</div>
          </div>
          
          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">62</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/sheldon-lu" title="GitHub &rarr; https://github.com/sheldon-lu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            </div>
          


          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
        <script>
//暂时储存文章中的内容
var div = $('.post-body');
//暂时储存目录的内容
var toc=$('.post-toc-wrap')
function password() {
  if(''){
  //将文章内容删除
    div.remove();
 //将目录删除 
    toc.remove();
  //将文章删除后，向原来文章的地方添加，应该出现的提示用户输入密码的样式
  //下面这里的第一个用textarea是因为如果在手机端的时候只能显示一部分文字，
  //只是拓展:input里面的字只能显示一行，不会自动换行，目前上网搜索没有发现好的办法，所以用了textarea，右下角的小三角通过resize:none 去掉。
   $('.post-header').after('<textarea class="description" value="Please enter your password and press enter to build" style="border: none;display: block;' +'width: 60%;margin: 0 auto;text-align: center;outline: none;margin-bottom: 50px;resize:none ">
      Please enter your password and press enter to build</textarea>' +
      '<div class="qiang" style="height: 100px;width: 60%;margin:0 auto">' +
      '<input class="password"  type="text" value="" style="border: none;display: block;border-bottom: 1px solid #ccc;' +
      'margin: 0 auto;outline: none;width:95%"/>' +
      '</div>')
      //绑定点击事件，如果是点击的.password 这个div就改变样式，如果是document中除了div之外的其他任何元素，就变回原来的样式。
    document.onclick = function (event) {
      var e = event || window.event;
      var elem = e.srcElement || e.target;

      while (elem) {
        if (elem != document) {
          if (elem.className == "password") {
            $(".password").animate({paddingTop:"30px",width:"100%",borderWidth:"2px"},300)
            return;
          }
          elem = elem.parentNode;
        } else {
          $(".password").animate({paddingTop:"0px",width:"95%",borderWidth:"1px"},300)
          return;
        }
      }
    }
    //绑定enter键按下后离开的事件
    $(document).keyup(function(event){
      if(event.keyCode ==13&&$('.password').length>0){
        //console.log($('.password').val())
        //console.log('')
        if ($('.password').val() == '') {
        //恢复文章内容
          (div).appendTo($(".post-header"))
          //恢复目录
          toc.appendTo($(".sidebar-inner"))
                 //删除本页面的输入密码组件
           $(".description").remove();
          $(".qiang").remove();
          $(".password").remove();
          //重新处理pjax事件,如果没有加pjax的从下面这行起到下面的else之间的代码需要去掉。
          //图片懒加载，没有加入此功能的这个函数需要去掉
	          $('img').lazyload({
	             placeholder: '../images/loading.gif',
	             effect: 'fadeIn',
	             threshold : 100,
	             failure_limit : 20,
	             skip_invisible : false
	           });
	           //pjax后出现文章不显示，没有pjax的下面四行需要去掉
	            $(".post-block").css({opacity:1});
	            $(".post-header").css({opacity:1});
	            $(".post-body").css({opacity:1});
	            $(".pagination").css({opacity:1});
        }else {
          alert("Sorry, the password is wrong.")
        }
      }
      //将document的keyup移除，防止在pjax的情况下会重复绑定事件
    });
  }
}
password();
</script>
      </div>
      <script>
//暂时储存文章中的内容
var div = $('.post-body');
//暂时储存目录的内容
var toc=$('.post-toc-wrap')
function password() {
  if(''){
  //将文章内容删除
    div.remove();
 //将目录删除 
    toc.remove();
  //将文章删除后，向原来文章的地方添加，应该出现的提示用户输入密码的样式
  //下面这里的第一个用textarea是因为如果在手机端的时候只能显示一部分文字，
  //只是拓展:input里面的字只能显示一行，不会自动换行，目前上网搜索没有发现好的办法，所以用了textarea，右下角的小三角通过resize:none 去掉。
   $('.post-header').after('<textarea class="description" value="Please enter your password and press enter to build" style="border: none;display: block;' +'width: 60%;margin: 0 auto;text-align: center;outline: none;margin-bottom: 50px;resize:none ">
      Please enter your password and press enter to build</textarea>' +
      '<div class="qiang" style="height: 100px;width: 60%;margin:0 auto">' +
      '<input class="password"  type="text" value="" style="border: none;display: block;border-bottom: 1px solid #ccc;' +
      'margin: 0 auto;outline: none;width:95%"/>' +
      '</div>')
      //绑定点击事件，如果是点击的.password 这个div就改变样式，如果是document中除了div之外的其他任何元素，就变回原来的样式。
    document.onclick = function (event) {
      var e = event || window.event;
      var elem = e.srcElement || e.target;

      while (elem) {
        if (elem != document) {
          if (elem.className == "password") {
            $(".password").animate({paddingTop:"30px",width:"100%",borderWidth:"2px"},300)
            return;
          }
          elem = elem.parentNode;
        } else {
          $(".password").animate({paddingTop:"0px",width:"95%",borderWidth:"1px"},300)
          return;
        }
      }
    }
    //绑定enter键按下后离开的事件
    $(document).keyup(function(event){
      if(event.keyCode ==13&&$('.password').length>0){
        //console.log($('.password').val())
        //console.log('')
        if ($('.password').val() == '') {
        //恢复文章内容
          (div).appendTo($(".post-header"))
          //恢复目录
          toc.appendTo($(".sidebar-inner"))
                 //删除本页面的输入密码组件
           $(".description").remove();
          $(".qiang").remove();
          $(".password").remove();
          //重新处理pjax事件,如果没有加pjax的从下面这行起到下面的else之间的代码需要去掉。
          //图片懒加载，没有加入此功能的这个函数需要去掉
	          $('img').lazyload({
	             placeholder: '../images/loading.gif',
	             effect: 'fadeIn',
	             threshold : 100,
	             failure_limit : 20,
	             skip_invisible : false
	           });
	           //pjax后出现文章不显示，没有pjax的下面四行需要去掉
	            $(".post-block").css({opacity:1});
	            $(".post-header").css({opacity:1});
	            $(".post-body").css({opacity:1});
	            $(".pagination").css({opacity:1});
        }else {
          alert("Sorry, the password is wrong.")
        }
      }
      //将document的keyup移除，防止在pjax的情况下会重复绑定事件
    });
  }
}
password();
</script>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <!--<i class="fa fa-user"></i>-->
    <i class="fa fa-heart" aria-hidden="true"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sheldon Lu</span>
  
  

  
</div>

<!--

  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a><span>　<i class="fa fa-bomb"></i></span>
  <span id="showDays"></span>
  </div>

-->
<span><i class="fa fa-bomb"></i></span>
<span id="showDays"></span>

<div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!--<span id="busuanzi_container_site_pv" style='display:none'>
    本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
    <span class="post-meta-divider">|</span>
</span>-->
<span id="busuanzi_container_site_uv" style="display:none">
    有<span id="busuanzi_value_site_uv"></span>人看过我的博客啦
</span>
</div>



<script>
  var seconds = 1000;
  var minutes = seconds * 60;
  var hours = minutes * 60;
  var days = hours * 24;
  var years = days * 365;
  var birthDay = Date.UTC(2019,03,15,00,00,00); // 这里设置建站时间
  setInterval(function() {
    var today = new Date();
    var todayYear = today.getFullYear();
    var todayMonth = today.getMonth()+1;
    var todayDate = today.getDate();
    var todayHour = today.getHours();
    var todayMinute = today.getMinutes();
    var todaySecond = today.getSeconds();
    var now = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
    var diff = now - birthDay;
    var diffYears = Math.floor(diff/years);
    var diffDays = Math.floor((diff/days)-diffYears*365);
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
      document.getElementById('showDays').innerHTML="本站已运行 "+diffYears+" 年 "+diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
  }, 1000);
</script>
        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>




  

  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'wcykO4AM4RdvFXlzAJAOVgGz-gzGzoHsz',
    appKey: '1okhim5n5Pq6KwHuFKmTRC9t',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn'
  });
</script>





  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'wcykO4AM4RdvFXlzAJAOVgGz-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'wcykO4AM4RdvFXlzAJAOVgGz-gzGzoHsz',
                'X-LC-Key': '1okhim5n5Pq6KwHuFKmTRC9t',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
