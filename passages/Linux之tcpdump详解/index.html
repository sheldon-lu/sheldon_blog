<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.sheldonlu.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="超详细的网络抓包神器 Tcpdump 使用指南前言  本文主要内容翻译自**《Tcpdump Examples》[1]**。  tcpdump 是一款强大的网络抓包工具，它使用 libpcap 库来抓取网络数据包，这个库在几乎在所有的 Linux&#x2F;Unix 中都有。熟悉 tcpdump 的使用能够帮助你分析调试网络数据，本文将通过一个个具体的示例来介绍它在不同场景下的使用方法。不管你是系">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux之tcpdump详解">
<meta property="og:url" content="https://www.sheldonlu.com/passages/Linux%E4%B9%8Btcpdump%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="Sheldon_Lu">
<meta property="og:description" content="超详细的网络抓包神器 Tcpdump 使用指南前言  本文主要内容翻译自**《Tcpdump Examples》[1]**。  tcpdump 是一款强大的网络抓包工具，它使用 libpcap 库来抓取网络数据包，这个库在几乎在所有的 Linux&#x2F;Unix 中都有。熟悉 tcpdump 的使用能够帮助你分析调试网络数据，本文将通过一个个具体的示例来介绍它在不同场景下的使用方法。不管你是系">
<meta property="og:locale">
<meta property="article:published_time" content="2020-09-22T05:43:31.000Z">
<meta property="article:modified_time" content="2020-09-24T07:35:43.459Z">
<meta property="article:author" content="Sheldon Lu">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.sheldonlu.com/passages/Linux%E4%B9%8Btcpdump%E8%AF%A6%E8%A7%A3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>Linux之tcpdump详解 | Sheldon_Lu</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sheldon_Lu</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://www.sheldonlu.com/passages/Linux%E4%B9%8Btcpdump%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sheldon Lu">
      <meta itemprop="description" content="静下心来写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sheldon_Lu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux之tcpdump详解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-22 13:43:31" itemprop="dateCreated datePublished" datetime="2020-09-22T13:43:31+08:00">2020-09-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-24 15:35:43" itemprop="dateModified" datetime="2020-09-24T15:35:43+08:00">2020-09-24</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>17 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="超详细的网络抓包神器-Tcpdump-使用指南"><a href="#超详细的网络抓包神器-Tcpdump-使用指南" class="headerlink" title="超详细的网络抓包神器 Tcpdump 使用指南"></a>超详细的网络抓包神器 Tcpdump 使用指南</h2><p><strong>前言</strong></p>
<blockquote>
<p>本文主要内容翻译自**《Tcpdump Examples》[1]**。</p>
</blockquote>
<p><code>tcpdump</code> 是一款强大的网络抓包工具，它使用 <code>libpcap</code> 库来抓取网络数据包，这个库在几乎在所有的 Linux&#x2F;Unix 中都有。熟悉 tcpdump 的使用能够帮助你分析调试网络数据，本文将通过一个个具体的示例来介绍它在不同场景下的使用方法。不管你是系统管理员，程序员，云原生工程师还是 yaml 工程师，掌握 tcpdump 的使用都能让你如虎添翼，升职加薪。<span id="more"></span></p>
<h3 id="01基本语法和使用方法"><a href="#01基本语法和使用方法" class="headerlink" title="01基本语法和使用方法"></a>01基本语法和使用方法</h3><p><code>tcpdump</code> 的常用参数如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 -nn -s0 -v port <span class="number">80</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>-i</strong> : 选择要捕获的接口，通常是以太网卡或无线网卡，也可以是 <code>vlan</code> 或其他特殊接口。如果该系统上只有一个网络接口，则无需指定。</li>
<li><strong>-nn</strong> : 单个 n 表示不解析域名，直接显示 IP；两个 n 表示不解析域名和端口。这样不仅方便查看 IP 和端口号，而且在抓取大量数据时非常高效，因为<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/cns?from=10680">域名解析</a>会降低抓取速度。</li>
<li><strong>-s0</strong> : tcpdump 默认只会截取前 <code>96</code> 字节的内容，要想截取所有的报文内容，可以使用 <code>-s number</code>， <code>number</code> 就是你要截取的报文字节数，如果是 0 的话，表示截取报文全部内容。</li>
<li><strong>-v</strong> : 使用 <code>-v</code>，<code>-vv</code> 和 <code>-vvv</code> 来显示更多的详细信息，通常会显示更多与特定协议相关的信息。</li>
<li><code>port 80</code> : 这是一个常见的端口过滤器，表示仅抓取 <code>80</code> 端口上的流量，通常是 HTTP。</li>
</ul>
<p>额外再介绍几个常用参数：</p>
<ul>
<li><strong>-p</strong> : 不让网络接口进入混杂模式。默认情况下使用 tcpdump 抓包时，会让网络接口进入混杂模式。一般计算机网卡都工作在非混杂模式下，此时网卡只接受来自网络端口的目的地址指向自己的数据。当网卡工作在混杂模式下时，网卡将来自接口的所有数据都捕获并交给相应的驱动程序。如果设备接入的交换机开启了混杂模式，使用 <code>-p</code> 选项可以有效地过滤噪声。</li>
<li><strong>-e</strong> : 显示数据链路层信息。默认情况下 tcpdump 不会显示数据链路层信息，使用 <code>-e</code> 选项可以显示源和目的 MAC 地址，以及 VLAN tag 信息。例如：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n -e -c <span class="number">5</span> not ip6</span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on br-lan, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.619865</span> <span class="number">24</span>:5<span class="attr">e</span>:<span class="attr">be</span>:0<span class="attr">c</span>:<span class="number">17</span>:af &gt; <span class="number">00</span>:<span class="attr">e2</span>:<span class="number">69</span>:<span class="number">23</span>:<span class="attr">d3</span>:3b, ethertype <span class="title class_">IPv4</span> (<span class="number">0x0800</span>), length <span class="number">1162</span>: <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.51410</span> &gt; <span class="number">180.176</span><span class="number">.26</span><span class="number">.193</span><span class="number">.58695</span>: <span class="title class_">Flags</span> [.], seq <span class="number">2045333376</span>:<span class="number">2045334484</span>, ack <span class="number">3398690514</span>, win <span class="number">751</span>, length <span class="number">1108</span></span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.626490</span> <span class="number">00</span>:<span class="attr">e2</span>:<span class="number">69</span>:<span class="number">23</span>:<span class="attr">d3</span>:3b &gt; <span class="number">24</span>:5<span class="attr">e</span>:<span class="attr">be</span>:0<span class="attr">c</span>:<span class="number">17</span>:af, ethertype <span class="title class_">IPv4</span> (<span class="number">0x0800</span>), length <span class="number">68</span>: <span class="number">220.173</span><span class="number">.179</span><span class="number">.66</span><span class="number">.36017</span> &gt; <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.51410</span>: <span class="variable constant_">UDP</span>, length <span class="number">26</span></span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.626893</span> <span class="number">24</span>:5<span class="attr">e</span>:<span class="attr">be</span>:0<span class="attr">c</span>:<span class="number">17</span>:af &gt; <span class="number">00</span>:<span class="attr">e2</span>:<span class="number">69</span>:<span class="number">23</span>:<span class="attr">d3</span>:3b, ethertype <span class="title class_">IPv4</span> (<span class="number">0x0800</span>), length <span class="number">1444</span>: <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.51410</span> &gt; <span class="number">220.173</span><span class="number">.179</span><span class="number">.66</span><span class="number">.36017</span>: <span class="variable constant_">UDP</span>, length <span class="number">1402</span></span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.628837</span> <span class="number">00</span>:<span class="attr">e2</span>:<span class="number">69</span>:<span class="number">23</span>:<span class="attr">d3</span>:3b &gt; <span class="number">24</span>:5<span class="attr">e</span>:<span class="attr">be</span>:0<span class="attr">c</span>:<span class="number">17</span>:af, ethertype <span class="title class_">IPv4</span> (<span class="number">0x0800</span>), length <span class="number">1324</span>: <span class="number">46.97</span><span class="number">.169</span><span class="number">.182</span><span class="number">.6881</span> &gt; <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.59145</span>: <span class="title class_">Flags</span> [P.], seq <span class="number">3058450381</span>:<span class="number">3058451651</span>, ack <span class="number">14349180</span>, win <span class="number">502</span>, length <span class="number">1270</span></span><br><span class="line"><span class="number">18</span>:<span class="number">27</span>:<span class="number">53.629096</span> <span class="number">24</span>:5<span class="attr">e</span>:<span class="attr">be</span>:0<span class="attr">c</span>:<span class="number">17</span>:af &gt; <span class="number">00</span>:<span class="attr">e2</span>:<span class="number">69</span>:<span class="number">23</span>:<span class="attr">d3</span>:3b, ethertype <span class="title class_">IPv4</span> (<span class="number">0x0800</span>), length <span class="number">54</span>: <span class="number">192.168</span><span class="number">.100</span><span class="number">.20</span><span class="number">.59145</span> &gt; <span class="number">192.168</span><span class="number">.100</span><span class="number">.1</span><span class="number">.12345</span>: <span class="title class_">Flags</span> [.], ack <span class="number">3058451651</span>, win <span class="number">6350</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">5</span> packets captured</span><br></pre></td></tr></table></figure>

<h4 id="显示-ASCII-字符串"><a href="#显示-ASCII-字符串" class="headerlink" title="显示 ASCII 字符串"></a>显示 ASCII 字符串</h4><p><code>-A</code> 表示使用 <code>ASCII</code> 字符串打印报文的全部数据，这样可以使读取更加简单，方便使用 <code>grep</code> 等工具解析输出内容。<code>-X</code> 表示同时使用十六进制和 <code>ASCII</code> 字符串打印报文的全部数据。这两个参数不能一起使用。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -A -s0 port <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h4 id="抓取特定协议的数据"><a href="#抓取特定协议的数据" class="headerlink" title="抓取特定协议的数据"></a>抓取特定协议的数据</h4><p>后面可以跟上协议名称来过滤特定协议的流量，以 UDP 为例，可以加上参数 udp 或 <code>protocol 17</code>，这两个命令意思相同。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 udp</span><br><span class="line">$ tcpdump -i eth0 proto <span class="number">17</span></span><br></pre></td></tr></table></figure>

<p>同理，tcp 与 <code>protocol 6</code> 意思相同。</p>
<h4 id="抓取特定主机的数据"><a href="#抓取特定主机的数据" class="headerlink" title="抓取特定主机的数据"></a>抓取特定主机的数据</h4><p>使用过滤器 <code>host</code> 可以抓取特定目的地和源 IP 地址的流量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 host <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>也可以使用 <code>src</code> 或 <code>dst</code> 只抓取源或目的地：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 dst <span class="number">10.10</span><span class="number">.1</span><span class="number">.20</span></span><br></pre></td></tr></table></figure>

<h4 id="将抓取的数据写入文件"><a href="#将抓取的数据写入文件" class="headerlink" title="将抓取的数据写入文件"></a>将抓取的数据写入文件</h4><p>使用 tcpdump 截取数据报文的时候，默认会打印到屏幕的默认输出，你会看到按照顺序和格式，很多的数据一行行快速闪过，根本来不及看清楚所有的内容。不过，tcpdump 提供了把截取的数据保存到文件的功能，以便后面使用其他图形工具（比如 wireshark，Snort）来分析。</p>
<p><code>-w</code> 选项用来把数据报文输出到文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 -s0 -w test.<span class="property">pcap</span></span><br></pre></td></tr></table></figure>

<h4 id="行缓冲模式"><a href="#行缓冲模式" class="headerlink" title="行缓冲模式"></a>行缓冲模式</h4><p>如果想实时将抓取到的数据通过管道传递给其他工具来处理，需要使用 <code>-l</code> 选项来开启行缓冲模式（或使用 <code>-c</code> 选项来开启数据包缓冲模式）。使用 <code>-l</code> 选项可以将输出通过立即发送给其他命令，其他命令会立即响应。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i eth0 -s0 -l port <span class="number">80</span> | grep <span class="string">&#x27;Server:&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="组合过滤器"><a href="#组合过滤器" class="headerlink" title="组合过滤器"></a>组合过滤器</h4><p>过滤的真正强大之处在于你可以随意组合它们，而连接它们的逻辑就是常用的 <code>与/AND/&amp;&amp;</code> 、 <code>或/OR/||</code> 和 <code>非/not/!</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">and or &amp;&amp;</span><br><span class="line">or or ||</span><br><span class="line">not or !</span><br></pre></td></tr></table></figure>

<h3 id="02过滤器"><a href="#02过滤器" class="headerlink" title="02过滤器"></a>02过滤器</h3><p>关于 tcpdump 的过滤器，这里有必要单独介绍一下。</p>
<p>机器上的网络报文数量异常的多，很多时候我们只关系和具体问题有关的数据报（比如访问某个网站的数据，或者 icmp 超时的报文等等），而这些数据只占到很小的一部分。把所有的数据截取下来，从里面找到想要的信息无疑是一件很费时费力的工作。而 tcpdump 提供了灵活的语法可以精确地截取关心的数据报，简化分析的工作量。这些选择数据包的语句就是过滤器（filter）！</p>
<h4 id="Host-过滤器"><a href="#Host-过滤器" class="headerlink" title="Host 过滤器"></a>Host 过滤器</h4><p>Host 过滤器用来过滤某个主机的数据报文。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump host <span class="number">1.2</span><span class="number">.3</span><span class="number">.4</span></span><br></pre></td></tr></table></figure>

<p>该命令会抓取所有发往主机 <code>1.2.3.4</code> 或者从主机 <code>1.2.3.4</code> 发出的流量。如果想只抓取从该主机发出的流量，可以使用下面的命令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump src host <span class="number">1.2</span><span class="number">.3</span><span class="number">.4</span></span><br></pre></td></tr></table></figure>

<h4 id="Network-过滤器"><a href="#Network-过滤器" class="headerlink" title="Network 过滤器"></a>Network 过滤器</h4><p>Network 过滤器用来过滤某个网段的数据，使用的是 <strong>CIDR[2]</strong> 模式。可以使用四元组（x.x.x.x）、三元组（x.x.x）、二元组（x.x）和一元组（x）。四元组就是指定某个主机，三元组表示子网掩码为 <code>255.255.255.0</code>，二元组表示子网掩码为 <code>255.255.0.0</code>，一元组表示子网掩码为 <code>255.0.0.0</code>。例如，</p>
<p>抓取所有发往网段 <code>192.168.1.x</code> 或从网段 <code>192.168.1.x</code> 发出的流量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump net <span class="number">192.168</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>抓取所有发往网段 <code>10.x.x.x</code> 或从网段 <code>10.x.x.x</code> 发出的流量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump net <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>和 Host 过滤器一样，这里也可以指定源和目的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump src net <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>也可以使用 CIDR 格式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump src net <span class="number">172.16</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">12</span></span><br></pre></td></tr></table></figure>

<h4 id="Proto-过滤器"><a href="#Proto-过滤器" class="headerlink" title="Proto 过滤器"></a>Proto 过滤器</h4><p>Proto 过滤器用来过滤某个协议的数据，关键字为 <code>proto</code>，可省略。proto 后面可以跟上协议号或协议名称，支持 <code>icmp</code>, <code>igmp</code>, <code>igrp</code>, <code>pim</code>, <code>ah</code>, <code>esp</code>, <code>carp</code>, <code>vrrp</code>, <code>udp</code>和 <code>tcp</code>。因为通常的协议名称是保留字段，所以在与 proto 指令一起使用时，必须根据 shell 类型使用一个或两个反斜杠（&#x2F;）来转义。Linux 中的 shell 需要使用两个反斜杠来转义，MacOS 只需要一个。</p>
<p>例如，抓取 icmp 协议的报文：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n proto \\icmp</span><br><span class="line"># 或者</span><br><span class="line">$ tcpdump -n icmp</span><br></pre></td></tr></table></figure>

<h4 id="Port-过滤器"><a href="#Port-过滤器" class="headerlink" title="Port 过滤器"></a>Port 过滤器</h4><p>Port 过滤器用来过滤通过某个端口的数据报文，关键字为 <code>port</code>。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump port <span class="number">389</span></span><br></pre></td></tr></table></figure>

<h3 id="03理解-tcpdump-的输出"><a href="#03理解-tcpdump-的输出" class="headerlink" title="03理解 tcpdump 的输出"></a>03理解 tcpdump 的输出</h3><p>截取数据只是第一步，第二步就是理解这些数据，下面就解释一下 tcpdump 命令输出各部分的意义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">06</span><span class="number">.995846</span> <span class="variable constant_">IP</span> (tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">45646</span>, offset <span class="number">0</span>, flags [<span class="variable constant_">DF</span>], proto <span class="variable constant_">TCP</span> (<span class="number">6</span>), length <span class="number">64</span>)</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.106</span><span class="number">.56166</span> &gt; <span class="number">124.192</span><span class="number">.132</span><span class="number">.54</span><span class="number">.80</span>: <span class="title class_">Flags</span> [S], cksum <span class="number">0xa730</span> (correct), seq <span class="number">992042666</span>, win <span class="number">65535</span>, options [mss <span class="number">1460</span>,nop,wscale <span class="number">4</span>,nop,nop,<span class="variable constant_">TS</span> val <span class="number">663433143</span> ecr <span class="number">0</span>,sackOK,eol], length <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">07</span><span class="number">.030487</span> <span class="variable constant_">IP</span> (tos <span class="number">0x0</span>, ttl <span class="number">51</span>, id <span class="number">0</span>, offset <span class="number">0</span>, flags [<span class="variable constant_">DF</span>], proto <span class="variable constant_">TCP</span> (<span class="number">6</span>), length <span class="number">44</span>)</span><br><span class="line">    <span class="number">124.192</span><span class="number">.132</span><span class="number">.54</span><span class="number">.80</span> &gt; <span class="number">192.168</span><span class="number">.1</span><span class="number">.106</span><span class="number">.56166</span>: <span class="title class_">Flags</span> [S.], cksum <span class="number">0xedc0</span> (correct), seq <span class="number">2147006684</span>, ack <span class="number">992042667</span>, win <span class="number">14600</span>, options [mss <span class="number">1440</span>], length <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">21</span>:<span class="number">27</span>:<span class="number">07</span><span class="number">.030527</span> <span class="variable constant_">IP</span> (tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">59119</span>, offset <span class="number">0</span>, flags [<span class="variable constant_">DF</span>], proto <span class="variable constant_">TCP</span> (<span class="number">6</span>), length <span class="number">40</span>)</span><br><span class="line">    <span class="number">192.168</span><span class="number">.1</span><span class="number">.106</span><span class="number">.56166</span> &gt; <span class="number">124.192</span><span class="number">.132</span><span class="number">.54</span><span class="number">.80</span>: <span class="title class_">Flags</span> [.], cksum <span class="number">0x3e72</span> (correct), ack <span class="number">2147006685</span>, win <span class="number">65535</span>, length <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>最基本也是最重要的信息就是数据报的源地址&#x2F;端口和目的地址&#x2F;端口，上面的例子第一条数据报中，源地址 ip 是 <code>192.168.1.106</code>，源端口是 <code>56166</code>，目的地址是 <code>124.192.132.54</code>，目的端口是 <code>80</code>。<code>&gt;</code> 符号代表数据的方向。</p>
<p>此外，上面的三条数据还是 tcp 协议的三次握手过程，第一条就是 <code>SYN</code> 报文，这个可以通过 <code>Flags [S]</code> 看出。下面是常见的 TCP 报文的 Flags:</p>
<ul>
<li><code>[S]</code> : SYN（开始连接）</li>
<li><code>[.]</code> : 没有 Flag</li>
<li><code>[P]</code> : PSH（推送数据）</li>
<li><code>[F]</code> : FIN （结束连接）</li>
<li><code>[R]</code> : RST（重置连接）</li>
</ul>
<p>而第二条数据的 <code>[S.]</code> 表示 <code>SYN-ACK</code>，就是 <code>SYN</code> 报文的应答报文。</p>
<h3 id="04例子"><a href="#04例子" class="headerlink" title="04例子"></a>04例子</h3><p>下面给出一些具体的例子，每个例子都可以使用多种方法来获得相同的输出，你使用的方法取决于所需的输出和网络上的流量。我们在排障时，通常只想获取自己想要的内容，可以通过过滤器和 ASCII 输出并结合管道与 grep、cut、awk 等工具来实现此目的。</p>
<p>例如，在抓取 HTTP 请求和响应数据包时，可以通过删除标志 <code>SYN/ACK/FIN</code> 来过滤噪声，但还有更简单的方法，那就是通过管道传递给 <code>grep</code>。在达到目的的同时，我们要选择最简单最高效的方法。下面来看例子。</p>
<h4 id="提取-HTTP-用户代理"><a href="#提取-HTTP-用户代理" class="headerlink" title="提取 HTTP 用户代理"></a>提取 HTTP 用户代理</h4><p>从 HTTP 请求头中提取 HTTP 用户代理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -A -s1500 -l | grep <span class="string">&quot;User-Agent:&quot;</span></span><br></pre></td></tr></table></figure>

<p>通过 <code>egrep</code> 可以同时提取用户代理和主机名（或其他头文件）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -A -s1500 -l | egrep -i <span class="string">&#x27;User-Agent:|Host:&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="只抓取-HTTP-GET-和-POST-流量"><a href="#只抓取-HTTP-GET-和-POST-流量" class="headerlink" title="只抓取 HTTP GET 和 POST 流量"></a>只抓取 HTTP GET 和 POST 流量</h4><p>抓取 HTTP GET 流量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s <span class="number">0</span> -A -vv <span class="string">&#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420&#x27;</span></span><br></pre></td></tr></table></figure>

<p>也可以抓取 HTTP POST 请求流量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s <span class="number">0</span> -A -vv <span class="string">&#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354&#x27;</span></span><br></pre></td></tr></table></figure>

<p>注意：该方法不能保证抓取到 HTTP POST 有效数据流量，因为一个 POST 请求会被分割为多个 TCP 数据包。</p>
<p>上述两个表达式中的十六进制将会与 GET 和 POST 请求的 <code>ASCII</code> 字符串匹配。例如，<code>tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4]</code> 首先会**确定我们感兴趣的字节的位置[3]**（在 TCP header 之后），然后选择我们希望匹配的 4 个字节。</p>
<h4 id="提取-HTTP-请求的-URL"><a href="#提取-HTTP-请求的-URL" class="headerlink" title="提取 HTTP 请求的 URL"></a>提取 HTTP 请求的 URL</h4><p>提取 HTTP 请求的主机名和路径：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s <span class="number">0</span> -v -n -l | egrep -i <span class="string">&quot;POST /|GET /|Host:&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: listening on enp7s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line">	<span class="variable constant_">POST</span> /wp-login.<span class="property">php</span> <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line">	<span class="title class_">Host</span>: dev.<span class="property">example</span>.<span class="property">com</span></span><br><span class="line">	<span class="variable constant_">GET</span> /wp-login.<span class="property">php</span> <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line">	<span class="title class_">Host</span>: dev.<span class="property">example</span>.<span class="property">com</span></span><br><span class="line">	<span class="variable constant_">GET</span> /favicon.<span class="property">ico</span> <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line">	<span class="title class_">Host</span>: dev.<span class="property">example</span>.<span class="property">com</span></span><br><span class="line">	<span class="variable constant_">GET</span> / <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line">	<span class="title class_">Host</span>: dev.<span class="property">example</span>.<span class="property">com</span></span><br></pre></td></tr></table></figure>

<h4 id="提取-HTTP-POST-请求中的密码"><a href="#提取-HTTP-POST-请求中的密码" class="headerlink" title="提取 HTTP POST 请求中的密码"></a>提取 HTTP POST 请求中的密码</h4><p>从 HTTP POST 请求中提取密码和主机名：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -s <span class="number">0</span> -A -n -l | egrep -i <span class="string">&quot;POST /|pwd=|passwd=|password=|Host:&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on enp7s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">11</span>:<span class="number">25</span>:<span class="number">54.799014</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.30</span><span class="number">.39224</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.125</span><span class="number">.80</span>: <span class="title class_">Flags</span> [P.], seq <span class="number">1458768667</span>:<span class="number">1458770008</span>, ack <span class="number">2440130792</span>, win <span class="number">704</span>, options [nop,nop,<span class="variable constant_">TS</span> val <span class="number">461552632</span> ecr <span class="number">208900561</span>], length <span class="number">1341</span>: <span class="attr">HTTP</span>: <span class="variable constant_">POST</span> /wp-login.<span class="property">php</span> <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line">.....<span class="property">s</span>..<span class="property">POST</span> /wp-login.<span class="property">php</span> <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="title class_">Host</span>: dev.<span class="property">example</span>.<span class="property">com</span></span><br><span class="line">.....<span class="property">s</span>..<span class="property">log</span>=admin&amp;pwd=notmypassword&amp;wp-submit=<span class="title class_">Log</span>+<span class="title class_">In</span>&amp;redirect_to=http%3A%2F%2Fdev.<span class="property">example</span>.<span class="property">com</span>%2Fwp-admin%2F&amp;testcookie=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="提取-Cookies"><a href="#提取-Cookies" class="headerlink" title="提取 Cookies"></a>提取 Cookies</h4><p>提取 <code>Set-Cookie</code>（服务端的 Cookie）和 <code>Cookie</code>（客户端的 Cookie）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -A -s0 -l | egrep -i <span class="string">&#x27;Set-Cookie|Host:|Cookie:&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on wlp58s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="title class_">Host</span>: dev.<span class="property">example</span>.<span class="property">com</span></span><br><span class="line"><span class="title class_">Cookie</span>: wordpress_86be02xxxxxxxxxxxxxxxxxxxc43=admin%7C152xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxfb3e15c744fdd6; _ga=<span class="title class_">GA1</span><span class="number">.2</span><span class="number">.21343434343421934</span>; _gid=<span class="title class_">GA1</span><span class="number">.2</span><span class="number">.927343434349426</span>; wordpress_test_cookie=<span class="variable constant_">WP</span>+<span class="title class_">Cookie</span>+check; wordpress_logged_in_86be654654645645645654645653fc43=admin%7C15275102testtesttesttestab7a61e; wp-settings-time-<span class="number">1</span>=<span class="number">1527337439</span></span><br></pre></td></tr></table></figure>

<h4 id="抓取-ICMP-数据包"><a href="#抓取-ICMP-数据包" class="headerlink" title="抓取 ICMP 数据包"></a>抓取 ICMP 数据包</h4><p>查看网络上的所有 ICMP 数据包：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n icmp</span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on enp7s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">11</span>:<span class="number">34</span>:<span class="number">21.590380</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.217</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.30</span>: <span class="variable constant_">ICMP</span> echo request, id <span class="number">27948</span>, seq <span class="number">1</span>, length <span class="number">64</span></span><br><span class="line"><span class="number">11</span>:<span class="number">34</span>:<span class="number">21.590434</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.30</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.217</span>: <span class="variable constant_">ICMP</span> echo reply, id <span class="number">27948</span>, seq <span class="number">1</span>, length <span class="number">64</span></span><br><span class="line"><span class="number">11</span>:<span class="number">34</span>:<span class="number">27.680307</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.159</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span>: <span class="variable constant_">ICMP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.189</span> udp port <span class="number">59619</span> unreachable, length <span class="number">115</span></span><br></pre></td></tr></table></figure>

<h4 id="抓取非-ECHO-x2F-REPLY-类型的-ICMP-数据包"><a href="#抓取非-ECHO-x2F-REPLY-类型的-ICMP-数据包" class="headerlink" title="抓取非 ECHO&#x2F;REPLY 类型的 ICMP 数据包"></a>抓取非 ECHO&#x2F;REPLY 类型的 ICMP 数据包</h4><p>通过排除 echo 和 reply 类型的数据包使抓取到的数据包不包括标准的 <code>ping</code> 包：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump <span class="string">&#x27;icmp[icmptype] != icmp-echo and icmp[icmptype] != icmp-echoreply&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on enp7s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">11</span>:<span class="number">37</span>:<span class="number">04</span><span class="number">.041037</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.189</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.20</span>: <span class="variable constant_">ICMP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.189</span> udp port <span class="number">36078</span> unreachable, length <span class="number">156</span></span><br></pre></td></tr></table></figure>

<h4 id="抓取-SMTP-x2F-POP3-协议的邮件"><a href="#抓取-SMTP-x2F-POP3-协议的邮件" class="headerlink" title="抓取 SMTP&#x2F;POP3 协议的邮件"></a>抓取 SMTP&#x2F;POP3 协议的邮件</h4><p>可以提取电子邮件的正文和其他数据。例如，只提取电子邮件的收件人：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn -l port <span class="number">25</span> | grep -i <span class="string">&#x27;MAIL FROM\|RCPT TO&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="抓取-NTP-服务的查询和响应"><a href="#抓取-NTP-服务的查询和响应" class="headerlink" title="抓取 NTP 服务的查询和响应"></a>抓取 NTP 服务的查询和响应</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump dst port <span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on eth0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">65535</span> bytes</span><br><span class="line"><span class="number">21</span>:<span class="number">02</span>:<span class="number">19.112502</span> <span class="variable constant_">IP</span> test33.<span class="property">ntp</span> &gt; <span class="number">199.30</span><span class="number">.140</span><span class="number">.74</span>.<span class="property">ntp</span>: <span class="title class_">NTPv4</span>, <span class="title class_">Client</span>, length <span class="number">48</span></span><br><span class="line"><span class="number">21</span>:<span class="number">02</span>:<span class="number">19.113888</span> <span class="variable constant_">IP</span> <span class="number">216.239</span><span class="number">.35</span><span class="number">.0</span>.<span class="property">ntp</span> &gt; test33.<span class="property">ntp</span>: <span class="title class_">NTPv4</span>, <span class="title class_">Server</span>, length <span class="number">48</span></span><br><span class="line"><span class="number">21</span>:<span class="number">02</span>:<span class="number">20.150347</span> <span class="variable constant_">IP</span> test33.<span class="property">ntp</span> &gt; <span class="number">216.239</span><span class="number">.35</span><span class="number">.0</span>.<span class="property">ntp</span>: <span class="title class_">NTPv4</span>, <span class="title class_">Client</span>, length <span class="number">48</span></span><br><span class="line"><span class="number">21</span>:<span class="number">02</span>:<span class="number">20.150991</span> <span class="variable constant_">IP</span> <span class="number">216.239</span><span class="number">.35</span><span class="number">.0</span>.<span class="property">ntp</span> &gt; test33.<span class="property">ntp</span>: <span class="title class_">NTPv4</span>, <span class="title class_">Server</span>, length <span class="number">48</span></span><br></pre></td></tr></table></figure>

<h4 id="抓取-SNMP-服务的查询和响应"><a href="#抓取-SNMP-服务的查询和响应" class="headerlink" title="抓取 SNMP 服务的查询和响应"></a>抓取 SNMP 服务的查询和响应</h4><p>通过 SNMP 服务，渗透测试人员可以获取大量的设备和系统信息。在这些信息中，系统信息最为关键，如操作系统版本、内核版本等。使用 SNMP 协议快速扫描程序 <code>onesixtyone</code>，可以看到目标系统的信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ onesixtyone <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span> public</span><br><span class="line"></span><br><span class="line"><span class="title class_">Scanning</span> <span class="number">1</span> hosts, <span class="number">1</span> communities</span><br><span class="line"><span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span> [public] <span class="title class_">Linux</span> test33 <span class="number">4.15</span><span class="number">.0</span>-<span class="number">20</span>-generic #<span class="number">21</span>-<span class="title class_">Ubuntu</span> <span class="variable constant_">SMP</span> <span class="title class_">Tue</span> <span class="title class_">Apr</span> <span class="number">24</span> <span class="number">06</span>:<span class="number">16</span>:<span class="number">15</span> <span class="variable constant_">UTC</span> <span class="number">2018</span> x86_64</span><br></pre></td></tr></table></figure>

<p>可以通过 tcpdump 抓取 <code>GetRequest</code> 和 <code>GetResponse</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -n -s0  port <span class="number">161</span> and udp</span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on wlp58s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">23</span>:<span class="number">39</span>:<span class="number">13.725522</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.159</span><span class="number">.36826</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.20</span><span class="number">.161</span>:  <span class="title class_">GetRequest</span>(<span class="number">28</span>)  <span class="number">.1</span><span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span></span><br><span class="line"><span class="number">23</span>:<span class="number">39</span>:<span class="number">13.728789</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.20</span><span class="number">.161</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.159</span><span class="number">.36826</span>:  <span class="title class_">GetResponse</span>(<span class="number">109</span>)  <span class="number">.1</span><span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span>=<span class="string">&quot;Linux testmachine 4.15.0-20-generic #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="切割-pcap-文件"><a href="#切割-pcap-文件" class="headerlink" title="切割 pcap 文件"></a>切割 pcap 文件</h4><p>当抓取大量数据并写入文件时，可以自动切割为多个大小相同的文件。例如，下面的命令表示每 3600 秒创建一个新文件 <code>capture-(hour).pcap</code>，每个文件大小不超过 <code>200*1000000</code> 字节：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump  -w /tmp/capture-%H.<span class="property">pcap</span> -G <span class="number">3600</span> -C <span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>这些文件的命名为 <code>capture-&#123;1-24&#125;.pcap</code>，24 小时之后，之前的文件就会被覆盖。</p>
<h4 id="抓取-IPv6-流量"><a href="#抓取-IPv6-流量" class="headerlink" title="抓取 IPv6 流量"></a>抓取 IPv6 流量</h4><p>可以通过过滤器 <code>ip6</code> 来抓取 IPv6 流量，同时可以指定协议如 TCP：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn ip6 proto <span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>从之前保存的文件中读取 IPv6 UDP 数据报文：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nr ipv6-test.<span class="property">pcap</span> ip6 proto <span class="number">17</span></span><br></pre></td></tr></table></figure>

<h4 id="检测端口扫描"><a href="#检测端口扫描" class="headerlink" title="检测端口扫描"></a>检测端口扫描</h4><p>在下面的例子中，你会发现抓取到的报文的源和目的一直不变，且带有标志位 <code>[S]</code> 和 <code>[R]</code>，它们与一系列看似随机的目标端口进行匹配。当发送 <code>SYN</code> 之后，如果目标主机的端口没有打开，就会返回一个 <code>RESET</code>。这是 <code>Nmap</code> 等端口扫描工具的标准做法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn</span><br><span class="line"></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693601</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.60460</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.5432</span>: <span class="title class_">Flags</span> [S], seq <span class="number">116466344</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090332</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693626</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.35470</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.513</span>: <span class="title class_">Flags</span> [S], seq <span class="number">3400074709</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090332</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693762</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.44244</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.389</span>: <span class="title class_">Flags</span> [S], seq <span class="number">2214070267</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090333</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693772</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.389</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.44244</span>: <span class="title class_">Flags</span> [R.], seq <span class="number">0</span>, ack <span class="number">2214070268</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693783</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.35172</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.1433</span>: <span class="title class_">Flags</span> [S], seq <span class="number">2358257571</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090333</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.693826</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.33022</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49153</span>: <span class="title class_">Flags</span> [S], seq <span class="number">2406028551</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090333</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695567</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.55130</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49154</span>: <span class="title class_">Flags</span> [S], seq <span class="number">3230403372</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090334</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695590</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49154</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.55130</span>: <span class="title class_">Flags</span> [R.], seq <span class="number">0</span>, ack <span class="number">3230403373</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695608</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.33460</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49152</span>: <span class="title class_">Flags</span> [S], seq <span class="number">3289070068</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090335</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695622</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.49152</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.33460</span>: <span class="title class_">Flags</span> [R.], seq <span class="number">0</span>, ack <span class="number">3289070069</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695637</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.34940</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.1029</span>: <span class="title class_">Flags</span> [S], seq <span class="number">140319147</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090335</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695650</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.1029</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.34940</span>: <span class="title class_">Flags</span> [R.], seq <span class="number">0</span>, ack <span class="number">140319148</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695664</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.45648</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.5060</span>: <span class="title class_">Flags</span> [S], seq <span class="number">2203629201</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090335</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695775</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.49028</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.2000</span>: <span class="title class_">Flags</span> [S], seq <span class="number">635990431</span>, win <span class="number">29200</span>, options [mss <span class="number">1460</span>,sackOK,<span class="variable constant_">TS</span> val <span class="number">3547090335</span> ecr <span class="number">0</span>,nop,wscale <span class="number">7</span>], length <span class="number">0</span></span><br><span class="line"><span class="number">21</span>:<span class="number">46</span>:<span class="number">19.695790</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.199</span><span class="number">.2000</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.10</span><span class="number">.49028</span>: <span class="title class_">Flags</span> [R.], seq <span class="number">0</span>, ack <span class="number">635990432</span>, win <span class="number">0</span>, length <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h4 id="过滤-Nmap-NSE-脚本测试结果"><a href="#过滤-Nmap-NSE-脚本测试结果" class="headerlink" title="过滤 Nmap NSE 脚本测试结果"></a>过滤 Nmap NSE 脚本测试结果</h4><p>本例中 Nmap NSE 测试脚本 <code>http-enum.nse</code> 用来检测 HTTP 服务的合法 URL。</p>
<p>在执行脚本测试的主机上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nmap -p <span class="number">80</span> --script=http-enum.<span class="property">nse</span> targetip</span><br></pre></td></tr></table></figure>

<p>在目标主机上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nn port <span class="number">80</span> | grep <span class="string">&quot;GET /&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">GET</span> /w3perl/ <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="variable constant_">GET</span> /w-agora/ <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="variable constant_">GET</span> /way-board/ <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="variable constant_">GET</span> /web800fo/ <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="variable constant_">GET</span> /webaccess/ <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="variable constant_">GET</span> /webadmin/ <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br><span class="line"><span class="variable constant_">GET</span> /webAdmin/ <span class="variable constant_">HTTP</span>/<span class="number">1.1</span></span><br></pre></td></tr></table></figure>

<h4 id="抓取-DNS-请求和响应"><a href="#抓取-DNS-请求和响应" class="headerlink" title="抓取 DNS 请求和响应"></a>抓取 DNS 请求和响应</h4><p>向 Google 公共 DNS 发起的出站 <code>DNS</code> 请求和 A 记录响应可以通过 tcpdump 抓取到：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -i wlp58s0 -s0 port <span class="number">53</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on wlp58s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">14</span>:<span class="number">19</span>:<span class="number">06</span><span class="number">.879799</span> <span class="variable constant_">IP</span> test<span class="number">.53852</span> &gt; google-public-dns-a.<span class="property">google</span>.<span class="property">com</span>.<span class="property">domain</span>: <span class="number">26977</span>+ [1au] A? play.<span class="property">google</span>.<span class="property">com</span>. (<span class="number">44</span>)</span><br><span class="line"><span class="number">14</span>:<span class="number">19</span>:<span class="number">07</span><span class="number">.022618</span> <span class="variable constant_">IP</span> google-public-dns-a.<span class="property">google</span>.<span class="property">com</span>.<span class="property">domain</span> &gt; test<span class="number">.53852</span>: <span class="number">26977</span> <span class="number">1</span>/<span class="number">0</span>/<span class="number">1</span> A <span class="number">216.58</span><span class="number">.203</span><span class="number">.110</span> (<span class="number">60</span>)</span><br></pre></td></tr></table></figure>

<h4 id="抓取-HTTP-有效数据包"><a href="#抓取-HTTP-有效数据包" class="headerlink" title="抓取 HTTP 有效数据包"></a>抓取 HTTP 有效数据包</h4><p>抓取 80 端口的 HTTP 有效数据包，排除 TCP 连接建立过程的数据包（SYN &#x2F; FIN &#x2F; ACK）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump <span class="string">&#x27;tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="将输出内容重定向到-Wireshark"><a href="#将输出内容重定向到-Wireshark" class="headerlink" title="将输出内容重定向到 Wireshark"></a>将输出内容重定向到 Wireshark</h4><p>通常 <code>Wireshark</code>（或 tshark）比 tcpdump 更容易分析应用层协议。一般的做法是在远程服务器上先使用 <code>tcpdump</code> 抓取数据并写入文件，然后再将文件拷贝到本地工作站上用 <code>Wireshark</code> 分析。</p>
<p>还有一种更高效的方法，可以通过 ssh 连接将抓取到的数据实时发送给 Wireshark 进行分析。以 MacOS 系统为例，可以通过 <code>brew cask install wireshark</code> 来安装，然后通过下面的命令来分析：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@remotesystem <span class="string">&#x27;tcpdump -s0 -c 1000 -nn -w - not port 22&#x27;</span> | <span class="regexp">/Applications/</span><span class="title class_">Wireshark</span>.<span class="property">app</span>/<span class="title class_">Contents</span>/<span class="title class_">MacOS</span>/<span class="title class_">Wireshark</span> -k -i -</span><br></pre></td></tr></table></figure>

<p>例如，如果想分析 DNS 协议，可以使用下面的命令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@remotesystem <span class="string">&#x27;tcpdump -s0 -c 1000 -nn -w - port 53&#x27;</span> | <span class="regexp">/Applications/</span><span class="title class_">Wireshark</span>.<span class="property">app</span>/<span class="title class_">Contents</span>/<span class="title class_">MacOS</span>/<span class="title class_">Wireshark</span> -k -i -</span><br></pre></td></tr></table></figure>

<p>抓取到的数据：</p>
<p><code>-c</code> 选项用来限制抓取数据的大小。如果不限制大小，就只能通过 <code>ctrl-c</code> 来停止抓取，这样一来不仅关闭了 tcpdump，也关闭了 wireshark。</p>
<h4 id="找出发包最多的-IP"><a href="#找出发包最多的-IP" class="headerlink" title="找出发包最多的 IP"></a>找出发包最多的 IP</h4><p>找出一段时间内发包最多的 IP，或者从一堆报文中找出发包最多的 IP，可以使用下面的命令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -nnn -t -c <span class="number">200</span> | cut -f <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> -d <span class="string">&#x27;.&#x27;</span> | sort | uniq -c | sort -nr | head -n <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on enp7s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">200</span> packets captured</span><br><span class="line"><span class="number">261</span> packets received by filter</span><br><span class="line"><span class="number">0</span> packets dropped by kernel</span><br><span class="line">    <span class="number">108</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.211</span><span class="number">.181</span></span><br><span class="line">     <span class="number">91</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.30</span></span><br><span class="line">      <span class="number">1</span> <span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.50</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>cut -f 1,2,3,4 -d ‘.’</strong> : 以 <code>.</code> 为分隔符，打印出每行的前四列。即 IP 地址。</li>
<li><strong>sort | uniq -c</strong> : 排序并计数</li>
<li><strong>sort -nr</strong> : 按照数值大小逆向排序</li>
</ul>
<h4 id="抓取用户名和密码"><a href="#抓取用户名和密码" class="headerlink" title="抓取用户名和密码"></a>抓取用户名和密码</h4><p>本例将重点放在标准纯文本协议上，过滤出于用户名和密码相关的报文：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump port http or port ftp or port smtp or port imap or port pop3 or port telnet -l -A | egrep -i -<span class="variable constant_">B5</span> <span class="string">&#x27;pass=|pwd=|log=|login=|user=|username=|pw=|passw=|passwd=|password=|pass:|user:|username:|password:|login:|pass |user &#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="抓取-DHCP-报文"><a href="#抓取-DHCP-报文" class="headerlink" title="抓取 DHCP 报文"></a>抓取 DHCP 报文</h4><p>最后一个例子，抓取 DHCP 服务的请求和响应报文，67 为 DHCP 端口，68 为客户机端口。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ tcpdump -v -n port <span class="number">67</span> or <span class="number">68</span></span><br><span class="line"></span><br><span class="line"><span class="attr">tcpdump</span>: listening on enp7s0, link-type <span class="title class_">EN10MB</span> (<span class="title class_">Ethernet</span>), capture size <span class="number">262144</span> bytes</span><br><span class="line"><span class="number">14</span>:<span class="number">37</span>:<span class="number">50.059662</span> <span class="variable constant_">IP</span> (tos <span class="number">0x10</span>, ttl <span class="number">128</span>, id <span class="number">0</span>, offset <span class="number">0</span>, flags [none], proto <span class="variable constant_">UDP</span> (<span class="number">17</span>), length <span class="number">328</span>)</span><br><span class="line">    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="number">.68</span> &gt; <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span><span class="number">.67</span>: <span class="variable constant_">BOOTP</span>/<span class="variable constant_">DHCP</span>, <span class="title class_">Request</span> <span class="keyword">from</span> <span class="number">00</span>:0<span class="attr">c</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:d5, length <span class="number">300</span>, xid <span class="number">0xc9779c2a</span>, <span class="title class_">Flags</span> [none]</span><br><span class="line">	  <span class="title class_">Client</span>-<span class="title class_">Ethernet</span>-<span class="title class_">Address</span> <span class="number">00</span>:0<span class="attr">c</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:d5</span><br><span class="line">	  <span class="title class_">Vendor</span>-rfc1048 <span class="title class_">Extensions</span></span><br><span class="line">	    <span class="title class_">Magic</span> <span class="title class_">Cookie</span> <span class="number">0x63825363</span></span><br><span class="line">	    <span class="variable constant_">DHCP</span>-<span class="title class_">Message</span> <span class="title class_">Option</span> <span class="number">53</span>, length <span class="number">1</span>: <span class="title class_">Request</span></span><br><span class="line">	    <span class="title class_">Requested</span>-<span class="variable constant_">IP</span> <span class="title class_">Option</span> <span class="number">50</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.163</span></span><br><span class="line">	    <span class="title class_">Hostname</span> <span class="title class_">Option</span> <span class="number">12</span>, length <span class="number">14</span>: <span class="string">&quot;test-ubuntu&quot;</span></span><br><span class="line">	    <span class="title class_">Parameter</span>-<span class="title class_">Request</span> <span class="title class_">Option</span> <span class="number">55</span>, length <span class="number">16</span>:</span><br><span class="line">	      <span class="title class_">Subnet</span>-<span class="title class_">Mask</span>, <span class="variable constant_">BR</span>, <span class="title class_">Time</span>-<span class="title class_">Zone</span>, <span class="title class_">Default</span>-<span class="title class_">Gateway</span></span><br><span class="line">	      <span class="title class_">Domain</span>-<span class="title class_">Name</span>, <span class="title class_">Domain</span>-<span class="title class_">Name</span>-<span class="title class_">Server</span>, <span class="title class_">Option</span> <span class="number">119</span>, <span class="title class_">Hostname</span></span><br><span class="line">	      <span class="title class_">Netbios</span>-<span class="title class_">Name</span>-<span class="title class_">Server</span>, <span class="title class_">Netbios</span>-<span class="title class_">Scope</span>, <span class="variable constant_">MTU</span>, <span class="title class_">Classless</span>-<span class="title class_">Static</span>-<span class="title class_">Route</span></span><br><span class="line">	      <span class="variable constant_">NTP</span>, <span class="title class_">Classless</span>-<span class="title class_">Static</span>-<span class="title class_">Route</span>-<span class="title class_">Microsoft</span>, <span class="title class_">Static</span>-<span class="title class_">Route</span>, <span class="title class_">Option</span> <span class="number">252</span></span><br><span class="line"><span class="number">14</span>:<span class="number">37</span>:<span class="number">50.059667</span> <span class="variable constant_">IP</span> (tos <span class="number">0x10</span>, ttl <span class="number">128</span>, id <span class="number">0</span>, offset <span class="number">0</span>, flags [none], proto <span class="variable constant_">UDP</span> (<span class="number">17</span>), length <span class="number">328</span>)</span><br><span class="line">    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="number">.68</span> &gt; <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span><span class="number">.67</span>: <span class="variable constant_">BOOTP</span>/<span class="variable constant_">DHCP</span>, <span class="title class_">Request</span> <span class="keyword">from</span> <span class="number">00</span>:0<span class="attr">c</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:d5, length <span class="number">300</span>, xid <span class="number">0xc9779c2a</span>, <span class="title class_">Flags</span> [none]</span><br><span class="line">	  <span class="title class_">Client</span>-<span class="title class_">Ethernet</span>-<span class="title class_">Address</span> <span class="number">00</span>:0<span class="attr">c</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:d5</span><br><span class="line">	  <span class="title class_">Vendor</span>-rfc1048 <span class="title class_">Extensions</span></span><br><span class="line">	    <span class="title class_">Magic</span> <span class="title class_">Cookie</span> <span class="number">0x63825363</span></span><br><span class="line">	    <span class="variable constant_">DHCP</span>-<span class="title class_">Message</span> <span class="title class_">Option</span> <span class="number">53</span>, length <span class="number">1</span>: <span class="title class_">Request</span></span><br><span class="line">	    <span class="title class_">Requested</span>-<span class="variable constant_">IP</span> <span class="title class_">Option</span> <span class="number">50</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.163</span></span><br><span class="line">	    <span class="title class_">Hostname</span> <span class="title class_">Option</span> <span class="number">12</span>, length <span class="number">14</span>: <span class="string">&quot;test-ubuntu&quot;</span></span><br><span class="line">	    <span class="title class_">Parameter</span>-<span class="title class_">Request</span> <span class="title class_">Option</span> <span class="number">55</span>, length <span class="number">16</span>:</span><br><span class="line">	      <span class="title class_">Subnet</span>-<span class="title class_">Mask</span>, <span class="variable constant_">BR</span>, <span class="title class_">Time</span>-<span class="title class_">Zone</span>, <span class="title class_">Default</span>-<span class="title class_">Gateway</span></span><br><span class="line">	      <span class="title class_">Domain</span>-<span class="title class_">Name</span>, <span class="title class_">Domain</span>-<span class="title class_">Name</span>-<span class="title class_">Server</span>, <span class="title class_">Option</span> <span class="number">119</span>, <span class="title class_">Hostname</span></span><br><span class="line">	      <span class="title class_">Netbios</span>-<span class="title class_">Name</span>-<span class="title class_">Server</span>, <span class="title class_">Netbios</span>-<span class="title class_">Scope</span>, <span class="variable constant_">MTU</span>, <span class="title class_">Classless</span>-<span class="title class_">Static</span>-<span class="title class_">Route</span></span><br><span class="line">	      <span class="variable constant_">NTP</span>, <span class="title class_">Classless</span>-<span class="title class_">Static</span>-<span class="title class_">Route</span>-<span class="title class_">Microsoft</span>, <span class="title class_">Static</span>-<span class="title class_">Route</span>, <span class="title class_">Option</span> <span class="number">252</span></span><br><span class="line"><span class="number">14</span>:<span class="number">37</span>:<span class="number">50.060780</span> <span class="variable constant_">IP</span> (tos <span class="number">0x0</span>, ttl <span class="number">64</span>, id <span class="number">53564</span>, offset <span class="number">0</span>, flags [none], proto <span class="variable constant_">UDP</span> (<span class="number">17</span>), length <span class="number">339</span>)</span><br><span class="line">    <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span><span class="number">.67</span> &gt; <span class="number">10.10</span><span class="number">.1</span><span class="number">.163</span><span class="number">.68</span>: <span class="variable constant_">BOOTP</span>/<span class="variable constant_">DHCP</span>, <span class="title class_">Reply</span>, length <span class="number">311</span>, xid <span class="number">0xc9779c2a</span>, <span class="title class_">Flags</span> [none]</span><br><span class="line">	  <span class="title class_">Your</span>-<span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.163</span></span><br><span class="line">	  <span class="title class_">Server</span>-<span class="variable constant_">IP</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">	  <span class="title class_">Client</span>-<span class="title class_">Ethernet</span>-<span class="title class_">Address</span> <span class="number">00</span>:0<span class="attr">c</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:<span class="attr">xx</span>:d5</span><br><span class="line">	  <span class="title class_">Vendor</span>-rfc1048 <span class="title class_">Extensions</span></span><br><span class="line">	    <span class="title class_">Magic</span> <span class="title class_">Cookie</span> <span class="number">0x63825363</span></span><br><span class="line">	    <span class="variable constant_">DHCP</span>-<span class="title class_">Message</span> <span class="title class_">Option</span> <span class="number">53</span>, length <span class="number">1</span>: <span class="variable constant_">ACK</span></span><br><span class="line">	    <span class="title class_">Server</span>-<span class="variable constant_">ID</span> <span class="title class_">Option</span> <span class="number">54</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">	    <span class="title class_">Lease</span>-<span class="title class_">Time</span> <span class="title class_">Option</span> <span class="number">51</span>, length <span class="number">4</span>: <span class="number">86400</span></span><br><span class="line">	    <span class="variable constant_">RN</span> <span class="title class_">Option</span> <span class="number">58</span>, length <span class="number">4</span>: <span class="number">43200</span></span><br><span class="line">	    <span class="variable constant_">RB</span> <span class="title class_">Option</span> <span class="number">59</span>, length <span class="number">4</span>: <span class="number">75600</span></span><br><span class="line">	    <span class="title class_">Subnet</span>-<span class="title class_">Mask</span> <span class="title class_">Option</span> <span class="number">1</span>, length <span class="number">4</span>: <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">	    <span class="variable constant_">BR</span> <span class="title class_">Option</span> <span class="number">28</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.255</span></span><br><span class="line">	    <span class="title class_">Domain</span>-<span class="title class_">Name</span>-<span class="title class_">Server</span> <span class="title class_">Option</span> <span class="number">6</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">	    <span class="title class_">Hostname</span> <span class="title class_">Option</span> <span class="number">12</span>, length <span class="number">14</span>: <span class="string">&quot;test-ubuntu&quot;</span></span><br><span class="line">	    <span class="variable constant_">T252</span> <span class="title class_">Option</span> <span class="number">252</span>, length <span class="number">1</span>: <span class="number">10</span></span><br><span class="line">	    <span class="title class_">Default</span>-<span class="title class_">Gateway</span> <span class="title class_">Option</span> <span class="number">3</span>, length <span class="number">4</span>: <span class="number">10.10</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<h3 id="05总结"><a href="#05总结" class="headerlink" title="05总结"></a>05总结</h3><p>本文主要介绍了 <code>tcpdump</code> 的基本语法和使用方法，并通过一些示例来展示它强大的过滤功能。将 tcpdump 与 wireshark 进行组合可以发挥更强大的功效，本文也展示了如何优雅顺滑地结合 tcpdump 和 wireshark。如果你想了解更多的细节，可以查看 tcpdump 的 <code>man</code> 手册。</p>
<p><code>本文转截: https://cloud.tencent.com/developer/article/1589827</code></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"># Linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/passages/Kubernetes%E5%AE%89%E8%A3%85-kubeadm-1-17-1-18/" rel="prev" title="Kubernetes安装-kubeadm-1.17/1.18">
      <i class="fa fa-chevron-left"></i> Kubernetes安装-kubeadm-1.17/1.18
    </a></div>
      <div class="post-nav-item">
    <a href="/passages/Linux%E4%B9%8Broute%E8%AF%A6%E8%A7%A3/" rel="next" title="Linux之route详解">
      Linux之route详解 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B6%85%E8%AF%A6%E7%BB%86%E7%9A%84%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E7%A5%9E%E5%99%A8-Tcpdump-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97"><span class="nav-number">1.</span> <span class="nav-text">超详细的网络抓包神器 Tcpdump 使用指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#01%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">01基本语法和使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA-ASCII-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.1.1.</span> <span class="nav-text">显示 ASCII 字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96%E7%89%B9%E5%AE%9A%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">1.1.2.</span> <span class="nav-text">抓取特定协议的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96%E7%89%B9%E5%AE%9A%E4%B8%BB%E6%9C%BA%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">1.1.3.</span> <span class="nav-text">抓取特定主机的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E6%8A%93%E5%8F%96%E7%9A%84%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.4.</span> <span class="nav-text">将抓取的数据写入文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%8C%E7%BC%93%E5%86%B2%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.5.</span> <span class="nav-text">行缓冲模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.1.6.</span> <span class="nav-text">组合过滤器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#02%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.2.</span> <span class="nav-text">02过滤器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Host-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.2.1.</span> <span class="nav-text">Host 过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Network-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.2.2.</span> <span class="nav-text">Network 过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Proto-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.2.3.</span> <span class="nav-text">Proto 过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Port-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.2.4.</span> <span class="nav-text">Port 过滤器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#03%E7%90%86%E8%A7%A3-tcpdump-%E7%9A%84%E8%BE%93%E5%87%BA"><span class="nav-number">1.3.</span> <span class="nav-text">03理解 tcpdump 的输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#04%E4%BE%8B%E5%AD%90"><span class="nav-number">1.4.</span> <span class="nav-text">04例子</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E5%8F%96-HTTP-%E7%94%A8%E6%88%B7%E4%BB%A3%E7%90%86"><span class="nav-number">1.4.1.</span> <span class="nav-text">提取 HTTP 用户代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AA%E6%8A%93%E5%8F%96-HTTP-GET-%E5%92%8C-POST-%E6%B5%81%E9%87%8F"><span class="nav-number">1.4.2.</span> <span class="nav-text">只抓取 HTTP GET 和 POST 流量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E5%8F%96-HTTP-%E8%AF%B7%E6%B1%82%E7%9A%84-URL"><span class="nav-number">1.4.3.</span> <span class="nav-text">提取 HTTP 请求的 URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E5%8F%96-HTTP-POST-%E8%AF%B7%E6%B1%82%E4%B8%AD%E7%9A%84%E5%AF%86%E7%A0%81"><span class="nav-number">1.4.4.</span> <span class="nav-text">提取 HTTP POST 请求中的密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E5%8F%96-Cookies"><span class="nav-number">1.4.5.</span> <span class="nav-text">提取 Cookies</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96-ICMP-%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="nav-number">1.4.6.</span> <span class="nav-text">抓取 ICMP 数据包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96%E9%9D%9E-ECHO-x2F-REPLY-%E7%B1%BB%E5%9E%8B%E7%9A%84-ICMP-%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="nav-number">1.4.7.</span> <span class="nav-text">抓取非 ECHO&#x2F;REPLY 类型的 ICMP 数据包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96-SMTP-x2F-POP3-%E5%8D%8F%E8%AE%AE%E7%9A%84%E9%82%AE%E4%BB%B6"><span class="nav-number">1.4.8.</span> <span class="nav-text">抓取 SMTP&#x2F;POP3 协议的邮件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96-NTP-%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%8D%E5%BA%94"><span class="nav-number">1.4.9.</span> <span class="nav-text">抓取 NTP 服务的查询和响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96-SNMP-%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%93%8D%E5%BA%94"><span class="nav-number">1.4.10.</span> <span class="nav-text">抓取 SNMP 服务的查询和响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%87%E5%89%B2-pcap-%E6%96%87%E4%BB%B6"><span class="nav-number">1.4.11.</span> <span class="nav-text">切割 pcap 文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96-IPv6-%E6%B5%81%E9%87%8F"><span class="nav-number">1.4.12.</span> <span class="nav-text">抓取 IPv6 流量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A3%80%E6%B5%8B%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-number">1.4.13.</span> <span class="nav-text">检测端口扫描</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4-Nmap-NSE-%E8%84%9A%E6%9C%AC%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="nav-number">1.4.14.</span> <span class="nav-text">过滤 Nmap NSE 脚本测试结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96-DNS-%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94"><span class="nav-number">1.4.15.</span> <span class="nav-text">抓取 DNS 请求和响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96-HTTP-%E6%9C%89%E6%95%88%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="nav-number">1.4.16.</span> <span class="nav-text">抓取 HTTP 有效数据包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0-Wireshark"><span class="nav-number">1.4.17.</span> <span class="nav-text">将输出内容重定向到 Wireshark</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%BE%E5%87%BA%E5%8F%91%E5%8C%85%E6%9C%80%E5%A4%9A%E7%9A%84-IP"><span class="nav-number">1.4.18.</span> <span class="nav-text">找出发包最多的 IP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81"><span class="nav-number">1.4.19.</span> <span class="nav-text">抓取用户名和密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%93%E5%8F%96-DHCP-%E6%8A%A5%E6%96%87"><span class="nav-number">1.4.20.</span> <span class="nav-text">抓取 DHCP 报文</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#05%E6%80%BB%E7%BB%93"><span class="nav-number">1.5.</span> <span class="nav-text">05总结</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Sheldon Lu</p>
  <div class="site-description" itemprop="description">静下心来写点东西</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/sheldon-lu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;sheldon-lu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sheldon Lu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
